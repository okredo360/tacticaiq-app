<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>TacticaIQ â€” Football Analysis Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@400;500;600;700&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg: #06090d;
  --s1: #0a0f16;
  --s2: #0f1621;
  --s3: #141e2b;
  --s4: #1a2635;
  --border: #1e2f42;
  --border2: #253a52;
  --accent: #00ff87;
  --accent-dim: rgba(0,255,135,.12);
  --accent-glow: 0 0 20px rgba(0,255,135,.3);
  --blue: #38bdf8;
  --orange: #fb923c;
  --red: #f43f5e;
  --yellow: #fbbf24;
  --purple: #a78bfa;
  --text: #e2eaf4;
  --text2: #7a94b0;
  --text3: #3a5570;
  --pitch1: #1e9148;
  --pitch2: #197a3d;
  --radius: 10px;
  --nav-h: 58px;
  --header-h: 52px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{height:100%;font-size:14px;}
body{
  background:var(--bg);color:var(--text);
  font-family:'JetBrains Mono',monospace;
  height:100%;overflow:hidden;
  -webkit-font-smoothing:antialiased;
}
::-webkit-scrollbar{width:3px;height:3px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
button{cursor:pointer;font-family:inherit;}
input,select,textarea{font-family:inherit;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{
  display:grid;
  grid-template-rows:var(--header-h) 1fr;
  grid-template-columns:72px 1fr;
  height:100vh;
}
@media(max-width:768px){
  #app{grid-template-columns:1fr;grid-template-rows:var(--header-h) 1fr var(--nav-h);}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#header{
  grid-column:1/-1;
  background:var(--s1);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;
  padding:0 16px;gap:14px;
  position:relative;z-index:100;
}
.logo{
  font-family:'Bebas Neue',sans-serif;
  font-size:1.6rem;letter-spacing:3px;
  color:var(--accent);
  text-shadow:var(--accent-glow);
  white-space:nowrap;flex-shrink:0;
}
.logo-tag{
  font-size:.55rem;letter-spacing:1.5px;
  color:var(--text3);font-family:'Barlow Condensed',sans-serif;
  text-transform:uppercase;margin-left:6px;
  display:inline-block;vertical-align:middle;
}
.header-search{
  flex:1;max-width:340px;
  display:flex;align-items:center;gap:8px;
  background:var(--s3);border:1px solid var(--border);
  border-radius:6px;padding:7px 12px;
}
.header-search input{
  background:none;border:none;outline:none;
  color:var(--text);font-size:.8rem;width:100%;
}
.header-search input::placeholder{color:var(--text3);}
.search-icon{color:var(--text3);font-size:.85rem;flex-shrink:0;}
.header-right{margin-left:auto;display:flex;align-items:center;gap:10px;}
.live-chip{
  display:flex;align-items:center;gap:5px;
  background:rgba(244,63,94,.1);border:1px solid rgba(244,63,94,.35);
  color:var(--red);font-family:'Barlow Condensed',sans-serif;
  font-weight:700;font-size:.72rem;letter-spacing:2px;
  padding:4px 10px;border-radius:20px;
}
.live-dot{width:5px;height:5px;border-radius:50%;background:var(--red);animation:pulse 1.2s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.2}}
.hdr-btn{
  width:34px;height:34px;border-radius:7px;
  background:var(--s3);border:1px solid var(--border);
  color:var(--text2);font-size:1rem;
  display:flex;align-items:center;justify-content:center;
  transition:all .2s;
}
.hdr-btn:hover{border-color:var(--accent);color:var(--accent);}
@media(max-width:768px){
  .header-search{display:none;}
  .logo-tag{display:none;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR NAV (desktop)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#sidenav{
  background:var(--s1);
  border-right:1px solid var(--border);
  padding:12px 8px;
  display:flex;flex-direction:column;gap:4px;
  overflow:hidden;
}
@media(max-width:768px){#sidenav{display:none;}}
.snav-item{
  width:56px;height:52px;border-radius:8px;
  display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:3px;
  color:var(--text3);font-family:'Barlow Condensed',sans-serif;
  font-size:.62rem;font-weight:600;letter-spacing:.5px;text-transform:uppercase;
  border:1px solid transparent;
  transition:all .2s;cursor:pointer;background:none;
}
.snav-item .icon{font-size:1.25rem;line-height:1;}
.snav-item:hover{color:var(--text2);background:var(--s3);}
.snav-item.active{
  color:var(--accent);background:var(--accent-dim);
  border-color:rgba(0,255,135,.2);
}
.snav-divider{height:1px;background:var(--border);margin:4px 0;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAV (mobile)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#bottomnav{
  display:none;
  background:var(--s1);
  border-top:1px solid var(--border);
  padding:6px 0;
  grid-row:3;
}
@media(max-width:768px){#bottomnav{display:flex;}}
.bnav-item{
  flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:2px;
  color:var(--text3);font-family:'Barlow Condensed',sans-serif;
  font-size:.6rem;font-weight:600;letter-spacing:.5px;
  text-transform:uppercase;cursor:pointer;background:none;border:none;
  padding:4px;transition:color .2s;
}
.bnav-item .icon{font-size:1.2rem;line-height:1;}
.bnav-item.active{color:var(--accent);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT AREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#main{
  overflow-y:auto;
  background:var(--bg);
  position:relative;
}
.page{display:none;padding:16px;animation:fadeUp .3s ease;}
.page.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITY COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{background:var(--s2);border:1px solid var(--border);border-radius:var(--radius);padding:14px;}
.card-title{
  font-family:'Barlow Condensed',sans-serif;font-weight:700;
  font-size:.78rem;letter-spacing:2px;text-transform:uppercase;
  color:var(--text2);margin-bottom:12px;
  display:flex;align-items:center;gap:7px;
}
.card-title::before{content:'';display:inline-block;width:3px;height:12px;background:var(--accent);border-radius:2px;flex-shrink:0;}
.tag{
  font-family:'Barlow Condensed',sans-serif;font-weight:700;
  font-size:.62rem;letter-spacing:1px;text-transform:uppercase;
  padding:2px 7px;border-radius:10px;
}
.tag-green{background:rgba(0,255,135,.12);color:var(--accent);}
.tag-blue{background:rgba(56,189,248,.12);color:var(--blue);}
.tag-orange{background:rgba(251,146,60,.12);color:var(--orange);}
.tag-red{background:rgba(244,63,94,.12);color:var(--red);}
.tag-purple{background:rgba(167,139,250,.12);color:var(--purple);}

.sbar{margin-bottom:8px;}
.sbar-row{display:flex;justify-content:space-between;font-size:.68rem;margin-bottom:3px;}
.sbar-row .lbl{color:var(--text2);}
.sbar-row .val{color:var(--accent);font-weight:500;}
.sbar-track{height:3px;background:var(--s4);border-radius:2px;overflow:hidden;}
.sbar-fill{height:100%;border-radius:2px;transition:width 1s ease;}
.fill-g{background:linear-gradient(90deg,#00c26a,#00ff87);}
.fill-b{background:linear-gradient(90deg,#0ea5e9,#38bdf8);}
.fill-o{background:linear-gradient(90deg,#ea7108,#fb923c);}
.fill-r{background:linear-gradient(90deg,#e11d48,#f43f5e);}
.fill-p{background:linear-gradient(90deg,#7c3aed,#a78bfa);}

.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;}
@media(max-width:600px){.grid2,.grid3{grid-template-columns:1fr;}}

.page-title{
  font-family:'Bebas Neue',sans-serif;
  font-size:1.8rem;letter-spacing:3px;
  color:var(--text);margin-bottom:4px;
}
.page-sub{font-size:.72rem;color:var(--text3);margin-bottom:16px;}

.btn{
  display:inline-flex;align-items:center;gap:6px;
  font-family:'Barlow Condensed',sans-serif;font-weight:700;
  font-size:.78rem;letter-spacing:1px;text-transform:uppercase;
  padding:8px 16px;border-radius:6px;border:none;
  transition:all .2s;cursor:pointer;
}
.btn-primary{background:var(--accent-dim);border:1px solid rgba(0,255,135,.3);color:var(--accent);}
.btn-primary:hover{background:rgba(0,255,135,.2);box-shadow:var(--accent-glow);}
.btn-secondary{background:var(--s3);border:1px solid var(--border);color:var(--text2);}
.btn-secondary:hover{border-color:var(--text2);color:var(--text);}
.btn-danger{background:rgba(244,63,94,.1);border:1px solid rgba(244,63,94,.3);color:var(--red);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STAT NUMBER BOX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stat-box{
  background:var(--s2);border:1px solid var(--border);
  border-radius:var(--radius);padding:14px;text-align:center;
}
.stat-box .num{
  font-family:'Bebas Neue',sans-serif;font-size:2.2rem;
  color:var(--accent);line-height:1;
}
.stat-box .lbl{font-size:.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-top:4px;}
.stat-box .change{font-size:.65rem;margin-top:3px;}
.change-up{color:var(--accent);}
.change-down{color:var(--red);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MATCH CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.match-card{
  background:var(--s2);border:1px solid var(--border);
  border-radius:var(--radius);padding:14px;
  cursor:pointer;transition:all .2s;
  position:relative;overflow:hidden;
}
.match-card::after{
  content:'';position:absolute;left:0;top:0;bottom:0;width:3px;
  background:var(--accent);transform:scaleY(0);transition:transform .2s;
  transform-origin:bottom;
}
.match-card:hover{border-color:rgba(0,255,135,.25);background:var(--s3);}
.match-card:hover::after{transform:scaleY(1);}
.mc-comp{font-size:.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;}
.mc-teams{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px;margin-bottom:8px;}
.mc-team-name{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:1rem;letter-spacing:.5px;}
.mc-team-name.home{text-align:left;}
.mc-team-name.away{text-align:right;}
.mc-score{
  font-family:'Bebas Neue',sans-serif;font-size:1.6rem;
  color:var(--accent);letter-spacing:4px;text-align:center;
  background:var(--accent-dim);border:1px solid rgba(0,255,135,.2);
  padding:2px 12px;border-radius:5px;white-space:nowrap;
}
.mc-footer{display:flex;align-items:center;justify-content:space-between;margin-top:8px;}
.mc-stats{display:flex;gap:10px;}
.mc-stat{font-size:.65rem;color:var(--text3);}
.mc-stat span{color:var(--text2);}
.mc-action{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:.68rem;letter-spacing:1px;color:var(--accent);text-transform:uppercase;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYER CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.player-card{
  background:var(--s2);border:1px solid var(--border);
  border-radius:var(--radius);padding:12px;
  cursor:pointer;transition:all .2s;
  display:flex;align-items:center;gap:10px;
}
.player-card:hover{border-color:rgba(0,255,135,.25);background:var(--s3);}
.pc-avi{
  width:40px;height:40px;border-radius:50%;
  background:var(--s4);display:flex;align-items:center;justify-content:center;
  font-size:1.2rem;border:2px solid var(--border);flex-shrink:0;
}
.pc-info{flex:1;min-width:0;}
.pc-name{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:1rem;letter-spacing:.3px;truncate:clip;}
.pc-detail{font-size:.65rem;color:var(--text2);margin-top:2px;display:flex;align-items:center;gap:6px;}
.pc-rating{
  font-family:'Bebas Neue',sans-serif;font-size:1.5rem;
  flex-shrink:0;line-height:1;
}
.pc-mini{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin-top:8px;}
.pcm{text-align:center;}
.pcm-val{font-family:'Bebas Neue',sans-serif;font-size:1rem;line-height:1;}
.pcm-lbl{font-size:.58rem;color:var(--text3);text-transform:uppercase;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PITCH SVG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pitch-wrap{
  background:var(--s2);border:1px solid var(--border);
  border-radius:var(--radius);padding:12px;
  margin-bottom:12px;
}
.pitch-wrap-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
svg.pitch{width:100%;display:block;border-radius:6px;}
.ptab-group{display:flex;gap:3px;flex-wrap:wrap;}
.ptab{
  background:var(--s3);border:1px solid var(--border);
  color:var(--text2);font-family:'Barlow Condensed',sans-serif;
  font-size:.7rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;
  padding:4px 10px;border-radius:4px;cursor:pointer;transition:all .2s;
}
.ptab.active,.ptab:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMATION BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.form-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:3px;}
.fb{
  background:var(--s4);border:1px solid var(--border);
  border-radius:4px;color:var(--text2);
  font-family:'JetBrains Mono',monospace;font-size:.65rem;
  padding:5px 2px;text-align:center;cursor:pointer;transition:all .15s;
}
.fb:hover,.fb.active{border-color:var(--accent);color:var(--accent);background:var(--accent-dim);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tgl-row{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);}
.tgl-row:last-child{border-bottom:none;}
.tgl-lbl{font-size:.73rem;color:var(--text2);}
.tgl{
  width:32px;height:16px;border-radius:8px;
  background:var(--s4);border:1px solid var(--border);
  position:relative;cursor:pointer;transition:all .2s;flex-shrink:0;
}
.tgl.on{background:rgba(0,255,135,.2);border-color:var(--accent);}
.tgl-k{
  position:absolute;top:2px;left:2px;
  width:10px;height:10px;border-radius:50%;
  background:var(--text3);transition:all .2s;
}
.tgl.on .tgl-k{left:18px;background:var(--accent);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tab-bar{display:flex;gap:3px;margin-bottom:14px;flex-wrap:wrap;}
.tab-btn{
  background:var(--s3);border:1px solid var(--border);
  color:var(--text2);font-family:'Barlow Condensed',sans-serif;
  font-size:.75rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;
  padding:6px 14px;border-radius:5px;cursor:pointer;transition:all .2s;
}
.tab-btn.active{background:var(--accent-dim);border-color:rgba(0,255,135,.3);color:var(--accent);}
.tab-pane{display:none;}
.tab-pane.active{display:block;animation:fadeUp .2s ease;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RADAR CANVAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.radar-wrap{display:flex;flex-direction:column;align-items:center;gap:8px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEATMAP CANVAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.heat-canvas-box{border-radius:8px;overflow:hidden;border:1px solid var(--border);}
canvas.heat{width:100%;display:block;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMELINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.timeline{position:relative;padding-left:18px;}
.timeline::before{content:'';position:absolute;left:5px;top:0;bottom:0;width:1px;background:var(--border);}
.tl-event{position:relative;padding:5px 0 5px 12px;}
.tl-event::before{
  content:'';position:absolute;left:-13px;top:9px;
  width:8px;height:8px;border-radius:50%;
  background:var(--accent);border:2px solid var(--bg);
}
.tl-event.ev-card::before{background:var(--yellow);}
.tl-event.ev-sub::before{background:var(--blue);}
.tl-event.ev-red::before{background:var(--red);}
.tl-event.ev-now::before{background:var(--text3);}
.tl-min{font-family:'Bebas Neue',sans-serif;font-size:.95rem;color:var(--accent);margin-right:6px;}
.ev-card .tl-min{color:var(--yellow);}
.ev-sub .tl-min{color:var(--blue);}
.ev-red .tl-min{color:var(--red);}
.ev-now .tl-min{color:var(--text3);}
.tl-name{color:var(--text);font-weight:500;}
.tl-desc{color:var(--text2);font-size:.7rem;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPARISON BARS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cmp-row{margin-bottom:8px;}
.cmp-hd{display:grid;grid-template-columns:1fr 80px 1fr;gap:4px;font-size:.68rem;margin-bottom:3px;align-items:center;}
.cmp-l{color:var(--blue);text-align:right;}
.cmp-lbl{text-align:center;color:var(--text3);font-size:.62rem;text-transform:uppercase;letter-spacing:.5px;}
.cmp-r{color:var(--red);}
.cmp-track{display:flex;height:4px;border-radius:2px;overflow:hidden;gap:1px;}
.cmp-left{background:var(--blue);border-radius:2px 0 0 2px;transition:width .8s ease;}
.cmp-right{background:var(--red);border-radius:0 2px 2px 0;flex:1;transition:all .8s ease;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOT MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.shot-map{position:relative;}
canvas.shots{width:100%;display:block;border-radius:6px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PASSING NETWORK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
canvas.passnet{width:100%;display:block;border-radius:6px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.setting-section{margin-bottom:18px;}
.setting-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:11px 14px;background:var(--s2);border:1px solid var(--border);
  border-radius:7px;margin-bottom:6px;
}
.sr-left .sr-title{font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:.88rem;letter-spacing:.3px;}
.sr-left .sr-sub{font-size:.67rem;color:var(--text3);margin-top:2px;}
.sr-right select,.sr-right input{
  background:var(--s4);border:1px solid var(--border);border-radius:4px;
  color:var(--text);font-size:.75rem;padding:5px 8px;outline:none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-bg{
  position:fixed;inset:0;background:rgba(0,0,0,.75);
  display:flex;align-items:center;justify-content:center;
  z-index:999;opacity:0;pointer-events:none;transition:opacity .2s;
}
.modal-bg.show{opacity:1;pointer-events:all;}
.modal{
  background:var(--s2);border:1px solid var(--border2);
  border-radius:12px;padding:20px;width:min(400px,92vw);
  transform:scale(.96);transition:transform .2s;max-height:80vh;overflow-y:auto;
}
.modal-bg.show .modal{transform:scale(1);}
.modal h3{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:2px;color:var(--accent);margin-bottom:14px;}
.modal-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;}
.modal label{display:block;font-size:.65rem;letter-spacing:1px;color:var(--text2);text-transform:uppercase;margin-bottom:4px;}
.modal input,.modal select{
  width:100%;background:var(--s4);border:1px solid var(--border);
  border-radius:4px;color:var(--text);font-family:'JetBrains Mono',monospace;
  font-size:.78rem;padding:7px 9px;outline:none;transition:border .2s;
}
.modal input:focus,.modal select:focus{border-color:var(--accent);}
.modal-actions{display:flex;gap:8px;margin-top:14px;}
.modal-actions button{flex:1;padding:9px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM CONTROL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.field{margin-bottom:10px;}
.field label{display:block;font-size:.65rem;letter-spacing:1px;color:var(--text2);text-transform:uppercase;margin-bottom:4px;}
.field input,.field select,.field textarea{
  width:100%;background:var(--s4);border:1px solid var(--border);
  border-radius:4px;color:var(--text);font-family:'JetBrains Mono',monospace;
  font-size:.78rem;padding:7px 9px;outline:none;transition:border .2s;
}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--accent);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPORT PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.report-header{
  background:var(--s2);border:1px solid var(--border);
  border-radius:var(--radius);padding:20px;margin-bottom:12px;
}
.report-title{font-family:'Bebas Neue',sans-serif;font-size:2.2rem;letter-spacing:4px;color:var(--accent);}
.report-sub{font-size:.7rem;color:var(--text2);margin-top:2px;}
.report-h{
  font-family:'Barlow Condensed',sans-serif;font-weight:700;
  font-size:.78rem;letter-spacing:2px;text-transform:uppercase;
  color:var(--blue);margin-bottom:8px;padding-bottom:4px;
  border-bottom:1px solid var(--border);
}
.report-p{font-size:.75rem;color:var(--text2);line-height:1.75;}
.report-p strong{color:var(--text);}
.grade-row{display:flex;flex-wrap:wrap;gap:10px;margin-top:6px;}
.grade-item{text-align:center;min-width:64px;}
.grade-circle{
  width:56px;height:56px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-family:'Bebas Neue',sans-serif;font-size:1.3rem;margin:0 auto;
  border:3px solid;
}
.grade-name{font-size:.65rem;color:var(--text2);margin-top:4px;}

/* Probability bar */
.prob-bar{display:flex;height:10px;border-radius:5px;overflow:hidden;gap:2px;margin:8px 0;}
.prob-h{background:var(--accent);border-radius:5px 0 0 5px;transition:width .8s ease;}
.prob-d{background:var(--text3);}
.prob-a{background:var(--red);border-radius:0 5px 5px 0;flex:1;}
.prob-nums{display:flex;justify-content:space-between;font-family:'Bebas Neue',sans-serif;font-size:1.2rem;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#searchOverlay{
  position:fixed;inset:0;background:rgba(0,0,0,.85);
  z-index:500;display:none;padding:60px 16px;
}
#searchOverlay.show{display:block;}
.search-box-lg{
  max-width:500px;margin:0 auto;
  background:var(--s2);border:1px solid var(--border2);
  border-radius:10px;padding:14px;
}
.search-box-lg input{
  width:100%;background:none;border:none;outline:none;
  color:var(--text);font-size:1rem;font-family:'JetBrains Mono',monospace;
}
.search-results{max-height:360px;overflow-y:auto;margin-top:10px;}
.sr-item{
  padding:10px 12px;border-radius:6px;cursor:pointer;
  display:flex;align-items:center;gap:10px;transition:background .15s;
}
.sr-item:hover{background:var(--s3);}
.sr-item .sri-icon{font-size:1.3rem;}
.sr-item .sri-title{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:.95rem;}
.sr-item .sri-sub{font-size:.65rem;color:var(--text3);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME PAGE SPECIFICS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero-band{
  background:linear-gradient(135deg,var(--s2) 0%,var(--s3) 100%);
  border:1px solid var(--border);border-radius:var(--radius);
  padding:18px;margin-bottom:12px;
  display:flex;align-items:center;justify-content:space-between;
  gap:12px;position:relative;overflow:hidden;
}
.hero-band::before{
  content:'âš½';position:absolute;right:-10px;bottom:-20px;
  font-size:6rem;opacity:.05;
}
.hero-title{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:2px;color:var(--text);}
.hero-sub{font-size:.72rem;color:var(--text2);margin-top:3px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTICE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notice{
  background:rgba(0,255,135,.06);border:1px solid rgba(0,255,135,.18);
  border-radius:6px;padding:10px 13px;font-size:.72rem;color:var(--text2);
  margin-bottom:10px;display:flex;gap:8px;align-items:flex-start;
}
.notice-icon{font-size:.9rem;flex-shrink:0;margin-top:1px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMATIONS PAGE DRAG AREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tactic-board{
  position:relative;user-select:none;
}
.player-marker{
  position:absolute;transform:translate(-50%,-50%);
  cursor:grab;transition:filter .15s;
}
.player-marker:active{cursor:grabbing;}
.player-marker:hover .pm-circle{filter:brightness(1.3);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLABLE CONTENT HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scroll-x{overflow-x:auto;-webkit-overflow-scrolling:touch;}
table{width:100%;border-collapse:collapse;}
th{
  font-family:'Barlow Condensed',sans-serif;font-size:.68rem;
  letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);
  text-align:left;padding:6px 8px;border-bottom:1px solid var(--border);
  white-space:nowrap;
}
td{padding:6px 8px;font-size:.76rem;border-bottom:1px solid var(--border);white-space:nowrap;}
tr:hover td{background:var(--s3);cursor:pointer;}
tr.sel-row td{background:rgba(0,255,135,.05);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACK BUTTON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.back-btn{
  display:inline-flex;align-items:center;gap:5px;
  background:var(--s3);border:1px solid var(--border);
  border-radius:5px;padding:5px 12px;
  color:var(--text2);font-family:'Barlow Condensed',sans-serif;
  font-size:.75rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;
  cursor:pointer;margin-bottom:14px;transition:all .2s;
}
.back-btn:hover{border-color:var(--accent);color:var(--accent);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MANAGER CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mgr-card{
  background:var(--s3);border:1px solid var(--border);
  border-radius:8px;padding:12px;
}
.mgr-top{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.mgr-avi{
  width:44px;height:44px;border-radius:8px;
  background:var(--s4);display:flex;align-items:center;justify-content:center;
  font-size:1.4rem;border:2px solid var(--border);flex-shrink:0;
}
.mgr-name{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:1rem;}
.mgr-club{font-size:.65rem;color:var(--blue);letter-spacing:1px;text-transform:uppercase;}
.mgr-rec{font-size:.65rem;color:var(--text3);margin-top:2px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATION BADGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notif-dot{
  position:absolute;top:6px;right:6px;
  width:7px;height:7px;border-radius:50%;
  background:var(--red);border:1px solid var(--bg);
}
</style>
</head>
<body>

<div id="app">

<!-- â”€â”€ HEADER â”€â”€ -->
<header id="header">
  <div class="logo">TacticaIQ<span class="logo-tag">Pro</span></div>
  <div class="header-search">
    <span class="search-icon">ğŸ”</span>
    <input type="text" placeholder="Search players, teams, matches..." id="searchInput" onfocus="openSearch()" readonly>
  </div>
  <div class="header-right">
    <div class="live-chip"><div class="live-dot"></div>LIVE</div>
    <button class="hdr-btn" onclick="openSearch()" title="Search">ğŸ”</button>
    <button class="hdr-btn" onclick="navigate('settings')" title="Settings" style="position:relative">âš™ï¸<div class="notif-dot"></div></button>
  </div>
</header>

<!-- â”€â”€ SIDEBAR NAV (desktop) â”€â”€ -->
<nav id="sidenav">
  <button class="snav-item active" onclick="navigate('home')" data-page="home">
    <span class="icon">ğŸ </span><span>Home</span>
  </button>
  <button class="snav-item" onclick="navigate('matches')" data-page="matches">
    <span class="icon">âš½</span><span>Matches</span>
  </button>
  <button class="snav-item" onclick="navigate('players')" data-page="players">
    <span class="icon">ğŸ‘¤</span><span>Players</span>
  </button>
  <button class="snav-item" onclick="navigate('formations')" data-page="formations">
    <span class="icon">ğŸ“</span><span>Tactics</span>
  </button>
  <div class="snav-divider"></div>
  <button class="snav-item" onclick="navigate('reports')" data-page="reports">
    <span class="icon">ğŸ“Š</span><span>Reports</span>
  </button>
  <button class="snav-item" onclick="navigate('settings')" data-page="settings">
    <span class="icon">âš™ï¸</span><span>Settings</span>
  </button>
</nav>

<!-- â”€â”€ MAIN â”€â”€ -->
<main id="main">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• HOME PAGE â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page active" id="page-home">
    <div class="hero-band">
      <div>
        <div class="hero-title">Welcome Back</div>
        <div class="hero-sub">3 matches Â· 6 teams Â· 66 players tracked</div>
      </div>
      <button class="btn btn-primary" onclick="navigate('matches')">View Matches â†’</button>
    </div>

    <div class="grid3" style="margin-bottom:12px">
      <div class="stat-box"><div class="num">3</div><div class="lbl">Matches</div><div class="change change-up">â†‘ Active</div></div>
      <div class="stat-box"><div class="num">66</div><div class="lbl">Players</div><div class="change change-up">â†‘ 2 New</div></div>
      <div class="stat-box"><div class="num">2.41</div><div class="lbl">Avg xG</div><div class="change change-up">â†‘ 0.3</div></div>
    </div>

    <div class="card-title" style="margin-bottom:8px;">Recent Matches</div>
    <div id="homeMatchList" style="display:flex;flex-direction:column;gap:8px;margin-bottom:14px;"></div>

    <div class="grid2">
      <div>
        <div class="card-title" style="margin-bottom:8px;">Top Performers</div>
        <div id="homeTopPlayers" style="display:flex;flex-direction:column;gap:6px;"></div>
      </div>
      <div>
        <div class="card-title" style="margin-bottom:8px;">Quick Actions</div>
        <div style="display:flex;flex-direction:column;gap:6px;">
          <button class="btn btn-primary" style="justify-content:flex-start;" onclick="navigate('matches')">âš½ &nbsp;Analyze a Match</button>
          <button class="btn btn-secondary" style="justify-content:flex-start;" onclick="navigate('players')">ğŸ‘¤ &nbsp;Browse Players</button>
          <button class="btn btn-secondary" style="justify-content:flex-start;" onclick="navigate('formations')">ğŸ“ &nbsp;Tactical Board</button>
          <button class="btn btn-secondary" style="justify-content:flex-start;" onclick="navigate('reports')">ğŸ“Š &nbsp;Generate Report</button>
        </div>
        <div class="notice" style="margin-top:10px">
          <span class="notice-icon">ğŸ’¡</span>
          <span>Click any match card to dive into full tactical analysis â€” formations, heatmaps, patterns, and more.</span>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• MATCHES PAGE â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-matches">
    <div class="page-title">Matches</div>
    <div class="page-sub">Select a match to analyse tactics, patterns & player performance</div>
    <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;">
      <button class="tab-btn active" onclick="filterMatches(this,'all')">All</button>
      <button class="tab-btn" onclick="filterMatches(this,'PL')">Premier League</button>
      <button class="tab-btn" onclick="filterMatches(this,'UCL')">Champions League</button>
      <button class="tab-btn" onclick="filterMatches(this,'LL')">La Liga</button>
    </div>
    <div id="matchesList" style="display:flex;flex-direction:column;gap:8px;"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• MATCH DETAIL PAGE â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-match">
    <button class="back-btn" onclick="navigate('matches')">â† Back to Matches</button>
    <div id="matchDetailContent"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• PLAYERS PAGE â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-players">
    <div class="page-title">Players</div>
    <div class="page-sub">Browse all 66 players across tracked teams</div>
    <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;align-items:center;">
      <input type="text" id="playerSearch" placeholder="Search playersâ€¦" oninput="filterPlayers()" style="background:var(--s2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.8rem;padding:7px 12px;outline:none;flex:1;min-width:160px;">
      <select id="posFilter" onchange="filterPlayers()" style="background:var(--s2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.78rem;padding:7px 10px;outline:none;">
        <option value="all">All Positions</option>
        <option value="GK">Goalkeepers</option>
        <option value="DEF">Defenders</option>
        <option value="MID">Midfielders</option>
        <option value="ATK">Attackers</option>
      </select>
      <select id="teamFilter" onchange="filterPlayers()" style="background:var(--s2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.78rem;padding:7px 10px;outline:none;">
        <option value="all">All Teams</option>
        <option value="Manchester City">Man City</option>
        <option value="Real Madrid">Real Madrid</option>
        <option value="Liverpool">Liverpool</option>
        <option value="Arsenal">Arsenal</option>
        <option value="Manchester United">Man United</option>
        <option value="Barcelona">Barcelona</option>
      </select>
    </div>
    <div style="margin-bottom:8px;font-size:.68rem;color:var(--text3)" id="playerCount"></div>
    <div id="playersList" style="display:flex;flex-direction:column;gap:6px;"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• PLAYER DETAIL PAGE â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-player">
    <button class="back-btn" onclick="navigate('players')">â† Back to Players</button>
    <div id="playerDetailContent"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• FORMATIONS PAGE â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-formations">
    <div class="page-title">Tactical Board</div>
    <div class="page-sub">Design formations, set pieces, and tactical instructions</div>

    <div style="display:grid;grid-template-columns:1fr 220px;gap:12px;">
      <div>
        <div class="pitch-wrap">
          <div class="pitch-wrap-hd">
            <span class="card-title" style="margin-bottom:0">Formation Editor</span>
            <span style="font-size:.65rem;color:var(--text3)">Click players to select</span>
          </div>
          <svg id="tacticSVG" class="pitch" viewBox="0 0 700 450"></svg>
          <div style="font-size:.65rem;color:var(--text3);text-align:center;margin-top:6px;">Click any player to view details Â· Select formation below to update</div>
        </div>

        <div class="grid2" style="margin-top:0;">
          <div class="card">
            <div class="card-title">Set Piece â€” Corner</div>
            <svg viewBox="0 0 300 190" width="100%" style="border-radius:6px;display:block;">
              <rect width="300" height="190" fill="#197a3d"/>
              <rect x="0" y="0" width="300" height="190" fill="none" stroke="rgba(255,255,255,.4)" stroke-width="1.2"/>
              <rect x="0" y="0" width="92" height="115" fill="none" stroke="rgba(255,255,255,.35)" stroke-width="1"/>
              <rect x="0" y="28" width="50" height="59" fill="none" stroke="rgba(255,255,255,.3)" stroke-width="1"/>
              <path d="M0 0 A12 12 0 0 0 12 12" fill="none" stroke="rgba(255,255,255,.35)" stroke-width="1"/>
              <defs><marker id="ca" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto"><polygon points="0 0,6 3,0 6" fill="rgba(255,255,255,.6)"/></marker></defs>
              <circle cx="5" cy="6" r="7" fill="#1565c0" stroke="#38bdf8" stroke-width="1.5"/>
              <path d="M5 6 Q55 -8 98 52" stroke="var(--accent)" stroke-width="1.5" fill="none" stroke-dasharray="4,3" marker-end="url(#ca)"/>
              <path d="M5 6 Q38 48 76 88" stroke="var(--blue)" stroke-width="1.5" fill="none" stroke-dasharray="4,3" marker-end="url(#ca)"/>
              <path d="M5 6 Q78 -4 138 68" stroke="var(--orange)" stroke-width="1.5" fill="none" stroke-dasharray="4,3" marker-end="url(#ca)"/>
              <circle cx="98" cy="52" r="7" fill="#1565c0" stroke="#38bdf8" stroke-width="1.5"/>
              <circle cx="76" cy="88" r="7" fill="#1565c0" stroke="#38bdf8" stroke-width="1.5"/>
              <circle cx="138" cy="68" r="7" fill="#1565c0" stroke="#38bdf8" stroke-width="1.5"/>
              <circle cx="68" cy="58" r="7" fill="#7b1c1c" stroke="#fca5a5" stroke-width="1.5"/>
              <circle cx="108" cy="78" r="7" fill="#7b1c1c" stroke="#fca5a5" stroke-width="1.5"/>
              <text x="150" y="180" fill="rgba(255,255,255,.3)" font-size="8" font-family="Barlow Condensed">Near Post Â· Far Post Â· Centre Crash</text>
            </svg>
          </div>
          <div class="card">
            <div class="card-title">Offside Trap</div>
            <svg viewBox="0 0 300 115" width="100%" style="border-radius:6px;display:block;">
              <rect width="300" height="115" fill="#197a3d"/>
              <rect width="300" height="115" fill="none" stroke="rgba(255,255,255,.4)" stroke-width="1"/>
              <line x1="178" y1="0" x2="178" y2="115" stroke="var(--yellow)" stroke-width="1.5" stroke-dasharray="6,4"/>
              <text x="182" y="13" fill="var(--yellow)" font-size="8" font-family="Barlow Condensed">OFFSIDE LINE</text>
              <circle cx="183" cy="38" r="7" fill="#1565c0" stroke="#38bdf8" stroke-width="1.5"/>
              <circle cx="183" cy="57" r="7" fill="#1565c0" stroke="#38bdf8" stroke-width="1.5"/>
              <circle cx="183" cy="76" r="7" fill="#1565c0" stroke="#38bdf8" stroke-width="1.5"/>
              <circle cx="180" cy="97" r="7" fill="#1565c0" stroke="#38bdf8" stroke-width="1.5"/>
              <circle cx="200" cy="57" r="7" fill="#7b1c1c" stroke="#fca5a5" stroke-width="1.5"/>
              <text x="210" y="61" fill="var(--red)" font-size="8" font-family="Barlow Condensed">OFFSIDE Ã—3</text>
              <circle cx="95" cy="57" r="5" fill="white" opacity=".9"/>
            </svg>
            <div style="font-size:.67rem;color:var(--text2);margin-top:6px;">High line avg: <span style="color:var(--accent)">68m</span> from goal. Caught offside <span style="color:var(--red)">3Ã—</span> in 2nd half.</div>
          </div>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:10px;">
        <div class="card">
          <div class="card-title">Formation</div>
          <div class="field">
            <label>Home Team</label>
            <select onchange="setTacticFormation('home',this.value)" id="tacticHomeForm">
              <option value="4-3-3">4-3-3</option>
              <option value="4-2-3-1" selected>4-2-3-1</option>
              <option value="4-4-2">4-4-2</option>
              <option value="3-5-2">3-5-2</option>
              <option value="3-4-3">3-4-3</option>
              <option value="5-3-2">5-3-2</option>
            </select>
          </div>
          <div class="field">
            <label>Away Team</label>
            <select onchange="setTacticFormation('away',this.value)" id="tacticAwayForm">
              <option value="4-3-3">4-3-3</option>
              <option value="4-2-3-1">4-2-3-1</option>
              <option value="4-4-2" selected>4-4-2</option>
              <option value="3-5-2">3-5-2</option>
              <option value="3-4-3">3-4-3</option>
              <option value="5-3-2">5-3-2</option>
            </select>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Overlays</div>
          <div class="tgl-row"><span class="tgl-lbl">Pressure Zones</span><div class="tgl on" onclick="tacticToggle(this,'pressure')"><div class="tgl-k"></div></div></div>
          <div class="tgl-row"><span class="tgl-lbl">Pass Lines</span><div class="tgl" onclick="tacticToggle(this,'pass')"><div class="tgl-k"></div></div></div>
          <div class="tgl-row"><span class="tgl-lbl">Space Zones</span><div class="tgl" onclick="tacticToggle(this,'space')"><div class="tgl-k"></div></div></div>
          <div class="tgl-row"><span class="tgl-lbl">Player Names</span><div class="tgl on" onclick="tacticToggle(this,'names')"><div class="tgl-k"></div></div></div>
        </div>

        <div class="card">
          <div class="card-title">Pressing Style</div>
          <div class="sbar"><div class="sbar-row"><span class="lbl">Intensity</span><span class="val" id="pressInt">High</span></div><input type="range" min="1" max="3" value="3" oninput="updateTacticLabel(this,'pressInt',['Low','Medium','High'])" style="width:100%;accent-color:var(--accent);margin-top:4px;"></div>
          <div class="sbar"><div class="sbar-row"><span class="lbl">Trigger Line</span><span class="val" id="trigLine">High</span></div><input type="range" min="1" max="3" value="3" oninput="updateTacticLabel(this,'trigLine',['Deep','Mid','High'])" style="width:100%;accent-color:var(--accent);margin-top:4px;"></div>
          <div class="sbar"><div class="sbar-row"><span class="lbl">Defensive Line</span><span class="val" id="defLine">High</span></div><input type="range" min="1" max="3" value="3" oninput="updateTacticLabel(this,'defLine',['Deep','Mid','High'])" style="width:100%;accent-color:var(--accent);margin-top:4px;"></div>
          <div class="sbar"><div class="sbar-row"><span class="lbl">Width</span><span class="val" id="widthLbl">Wide</span></div><input type="range" min="1" max="3" value="3" oninput="updateTacticLabel(this,'widthLbl',['Narrow','Balanced','Wide'])" style="width:100%;accent-color:var(--accent);margin-top:4px;"></div>
        </div>

        <div class="card">
          <div class="card-title">Substitution Planner</div>
          <div style="display:flex;flex-direction:column;gap:6px;">
            <div style="display:flex;gap:5px;align-items:center;">
              <select style="flex:1;background:var(--s4);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:.7rem;padding:5px 6px;outline:none;">
                <option>Camavinga</option><option>Valverde</option><option>TchouamÃ©ni</option>
              </select>
              <span style="color:var(--text3);">â†’</span>
              <select style="flex:1;background:var(--s4);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:.7rem;padding:5px 6px;outline:none;">
                <option>ModriÄ‡</option><option>Ceballos</option><option>GÃ¼ler</option>
              </select>
            </div>
            <button class="btn btn-secondary" style="font-size:.68rem;padding:6px;">+ Add Sub</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• REPORTS PAGE â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-reports">
    <div class="page-title">Reports</div>
    <div class="page-sub">Auto-generated match analysis & tactical insights</div>

    <div id="reportsContent"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• SETTINGS PAGE â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-settings">
    <div class="page-title">Settings</div>
    <div class="page-sub">Customise your analysis platform</div>

    <div class="setting-section">
      <div class="card-title" style="margin-bottom:8px">Display</div>
      <div class="setting-row">
        <div class="sr-left"><div class="sr-title">Default Competition</div><div class="sr-sub">Used for new match analysis</div></div>
        <div class="sr-right"><select><option>UEFA Champions League</option><option>Premier League</option><option>La Liga</option><option>Bundesliga</option><option>Serie A</option></select></div>
      </div>
      <div class="setting-row">
        <div class="sr-left"><div class="sr-title">xG Model</div><div class="sr-sub">Expected goals calculation method</div></div>
        <div class="sr-right"><select><option>StatsBomb v2</option><option>Opta</option><option>Custom</option></select></div>
      </div>
      <div class="setting-row">
        <div class="sr-left"><div class="sr-title">Distance Unit</div><div class="sr-sub">For movement & sprint data</div></div>
        <div class="sr-right"><select><option>Kilometres (km)</option><option>Miles (mi)</option></select></div>
      </div>
    </div>

    <div class="setting-section">
      <div class="card-title" style="margin-bottom:8px">Pitch</div>
      <div class="setting-row">
        <div class="sr-left"><div class="sr-title">Player Labels</div><div class="sr-sub">Show names or numbers on pitch</div></div>
        <div class="sr-right"><div class="tgl on" onclick="this.classList.toggle('on');this.querySelector('.tgl-k').style.left=this.classList.contains('on')?'18px':'2px'"><div class="tgl-k" style="position:absolute;top:2px;left:18px;width:10px;height:10px;border-radius:50%;background:var(--accent);transition:all .2s;"></div></div></div>
      </div>
      <div class="setting-row">
        <div class="sr-left"><div class="sr-title">Show Pressure Zones</div><div class="sr-sub">Default overlay state</div></div>
        <div class="sr-right"><div class="tgl on" onclick="this.classList.toggle('on')"><div class="tgl-k"></div></div></div>
      </div>
      <div class="setting-row">
        <div class="sr-left"><div class="sr-title">Pitch Orientation</div><div class="sr-sub">Attack direction</div></div>
        <div class="sr-right"><select><option>Left to Right</option><option>Right to Left</option><option>Auto</option></select></div>
      </div>
    </div>

    <div class="setting-section">
      <div class="card-title" style="margin-bottom:8px">Data & Export</div>
      <div class="setting-row">
        <div class="sr-left"><div class="sr-title">Auto-Generate Reports</div><div class="sr-sub">After each match analysis</div></div>
        <div class="sr-right"><div class="tgl" onclick="this.classList.toggle('on')"><div class="tgl-k"></div></div></div>
      </div>
      <div class="setting-row">
        <div class="sr-left"><div class="sr-title">Export Format</div><div class="sr-sub">Default report export type</div></div>
        <div class="sr-right"><select><option>PDF</option><option>HTML</option><option>CSV</option></select></div>
      </div>
    </div>

    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button class="btn btn-primary" onclick="alert('Settings saved!')">Save Settings</button>
      <button class="btn btn-secondary">Reset Defaults</button>
      <button class="btn btn-danger" onclick="if(confirm('Clear all data?')){}">Clear Data</button>
    </div>
  </div>

</main>

<!-- â”€â”€ BOTTOM NAV (mobile) â”€â”€ -->
<nav id="bottomnav">
  <button class="bnav-item active" onclick="navigate('home')" data-page="home"><span class="icon">ğŸ </span><span>Home</span></button>
  <button class="bnav-item" onclick="navigate('matches')" data-page="matches"><span class="icon">âš½</span><span>Matches</span></button>
  <button class="bnav-item" onclick="navigate('players')" data-page="players"><span class="icon">ğŸ‘¤</span><span>Players</span></button>
  <button class="bnav-item" onclick="navigate('formations')" data-page="formations"><span class="icon">ğŸ“</span><span>Tactics</span></button>
  <button class="bnav-item" onclick="navigate('reports')" data-page="reports"><span class="icon">ğŸ“Š</span><span>Reports</span></button>
</nav>

</div><!-- #app -->

<!-- SEARCH OVERLAY -->
<div id="searchOverlay" onclick="if(event.target===this)closeSearch()">
  <div class="search-box-lg">
    <input type="text" id="searchOverlayInput" placeholder="Search players, matches, teamsâ€¦" oninput="doSearch(this.value)" autofocus>
    <div class="search-results" id="searchResults"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG & STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let API_BASE = localStorage.getItem('tacticaiq_api') || 'https://tacticaiq-server-production.up.railway.app/api';
let livePollingInterval = null;
let liveConnected = false;
let currentPage = 'home';
let tacticHomeForm = '4-2-3-1';
let tacticAwayForm = '4-4-2';
let tacticOverlays = { pressure: true, pass: false, space: false, names: true };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MATCHES = [
  { id:'m1', comp:'Premier League', compKey:'PL', date:'Feb 23, 2025',
    home:'Manchester City', away:'Manchester United', homeScore:3, awayScore:1,
    minute:'FT', status:'finished',
    homeManager:'Pep Guardiola', awayManager:'RÃºben Amorim',
    homeFormation:'4-3-3', awayFormation:'4-2-3-1',
    stats:{ possession:[63,37], shots:[10,7], onTarget:[7,3], xg:[2.41,1.33], passAcc:[89,81], corners:[5,3], fouls:[8,11] },
    events:[
      { min:12, type:'goal', team:'home', player:'Haaland', desc:'Goal â€” De Bruyne assist' },
      { min:28, type:'card', team:'away', player:'Casemiro', desc:'ğŸŸ¡ Yellow â€” dangerous tackle' },
      { min:52, type:'goal', team:'home', player:'De Bruyne', desc:'Goal â€” penalty converted' },
      { min:67, type:'goal', team:'home', player:'Foden', desc:'Goal â€” long-range effort' },
      { min:71, type:'goal', team:'away', player:'Rashford', desc:'Goal â€” counter-attack' },
      { min:82, type:'sub', team:'away', player:'Hojlund â†‘', desc:'on for Rashford' },
    ],
    patterns:['High Press (88%)','Left Flank Overload (74%)','Build-Up Through Mid (91%)','Counter-Press 6s (67%)'],
    winProb:[72,9,19] },
  { id:'m2', comp:'Premier League', compKey:'PL', date:'Feb 22, 2025',
    home:'Liverpool', away:'Arsenal', homeScore:2, awayScore:0,
    minute:'FT', status:'finished',
    homeManager:'Arne Slot', awayManager:'Mikel Arteta',
    homeFormation:'4-3-3', awayFormation:'4-2-3-1',
    stats:{ possession:[55,45], shots:[12,6], onTarget:[5,2], xg:[1.94,0.81], passAcc:[87,84], corners:[7,4], fouls:[10,9] },
    events:[
      { min:18, type:'goal', team:'home', player:'Salah', desc:'Goal â€” right-foot finish' },
      { min:35, type:'card', team:'away', player:'Declan Rice', desc:'ğŸŸ¡ Yellow â€” foul on Salah' },
      { min:61, type:'goal', team:'home', player:'NÃºÃ±ez', desc:'Goal â€” header from corner' },
      { min:74, type:'sub', team:'away', player:'Trossard â†‘', desc:'on for Martinelli' },
    ],
    patterns:['Wide Press Trigger (82%)','Switch of Play (79%)','High Block (68%)','Gegenpressing (91%)'],
    winProb:[61,18,21] },
  { id:'m3', comp:'La Liga', compKey:'LL', date:'Feb 21, 2025',
    home:'Real Madrid', away:'Barcelona', homeScore:4, awayScore:1,
    minute:'FT', status:'finished',
    homeManager:'Carlo Ancelotti', awayManager:'Hansi Flick',
    homeFormation:'4-2-3-1', awayFormation:'4-3-3',
    stats:{ possession:[47,53], shots:[15,9], onTarget:[9,4], xg:[3.21,1.12], passAcc:[83,88], corners:[6,5], fouls:[13,8] },
    events:[
      { min:8, type:'goal', team:'home', player:'MbappÃ©', desc:'Goal â€” solo run, curled finish' },
      { min:21, type:'goal', team:'home', player:'Bellingham', desc:'Goal â€” headed from Carvajal cross' },
      { min:33, type:'goal', team:'away', player:'Lewandowski', desc:'Goal â€” penalty converted' },
      { min:44, type:'card', team:'away', player:'CubarsÃ­', desc:'ğŸŸ¡ Yellow â€” tactical foul' },
      { min:58, type:'goal', team:'home', player:'VinÃ­cius', desc:'Goal â€” dribble and finish' },
      { min:87, type:'goal', team:'home', player:'Valverde', desc:'Goal â€” long-range strike' },
    ],
    patterns:['Counter-Attack (85%)','Wide Overloads (71%)','Low Block vs Possession (77%)','Quick Transitions (88%)'],
    winProb:[55,14,31] },
];

const PLAYERS = [
  { id:'p1', name:'Erling Haaland', pos:'ST', team:'Manchester City', avi:'ğŸ”¥', rating:9.1, goals:24, ast:5, passAcc:72, posGroup:'ATK', attrs:{ Finishing:95, Pace:89, Positioning:97, 'Aerial Duels':91, 'Hold-Up Play':82 }, mini:['24 Goals','6 Shots/G','0.82 xG'] },
  { id:'p2', name:'Kevin De Bruyne', pos:'CM', team:'Manchester City', avi:'ğŸ¯', rating:8.7, goals:8, ast:14, passAcc:91, posGroup:'MID', attrs:{ Passing:97, Vision:98, Shooting:87, Dribbling:85, Creativity:99 }, mini:['8 Goals','14 Assists','91% Pass'] },
  { id:'p3', name:'Rodri', pos:'DM', team:'Manchester City', avi:'ğŸ–ï¸', rating:8.9, goals:4, ast:7, passAcc:94, posGroup:'MID', attrs:{ Passing:93, Positioning:95, Defending:88, Vision:90, Stamina:91 }, mini:['94% Pass','8 Recov/G','3 Interc/G'] },
  { id:'p4', name:'Phil Foden', pos:'LW', team:'Manchester City', avi:'âš¡', rating:8.4, goals:11, ast:9, passAcc:87, posGroup:'ATK', attrs:{ Dribbling:90, Shooting:87, Passing:85, Creativity:92, Pace:86 }, mini:['11 Goals','9 Assists','87% Pass'] },
  { id:'p5', name:'RÃºben Dias', pos:'CB', team:'Manchester City', avi:'ğŸ›¡ï¸', rating:8.2, goals:1, ast:1, passAcc:88, posGroup:'DEF', attrs:{ Aerial:88, Defending:91, Positioning:90, Passing:78, Leadership:87 }, mini:['1.2 Clears/G','0.8 Int/G','88% Pass'] },
  { id:'p6', name:'Ederson', pos:'GK', team:'Manchester City', avi:'ğŸ§¤', rating:8.0, goals:0, ast:0, passAcc:70, posGroup:'GK', attrs:{ Stopping:88, Distribution:90, Sweeping:84, Command:87, Reflexes:86 }, mini:['0.8 GA/G','72% Save','70% Pass'] },
  { id:'p7', name:'Kylian MbappÃ©', pos:'CF', team:'Real Madrid', avi:'ğŸš€', rating:8.8, goals:22, ast:8, passAcc:78, posGroup:'ATK', attrs:{ Pace:99, Dribbling:93, Finishing:92, '1v1':95, Pressing:78 }, mini:['22 Goals','8 Assists','99 Pace'] },
  { id:'p8', name:'Jude Bellingham', pos:'AM', team:'Real Madrid', avi:'âš¡', rating:8.5, goals:15, ast:10, passAcc:86, posGroup:'MID', attrs:{ Shooting:90, Passing:88, Dribbling:87, Vision:92, Positioning:91 }, mini:['15 Goals','10 Assists','86% Pass'] },
  { id:'p9', name:'VinÃ­cius Jr.', pos:'LW', team:'Real Madrid', avi:'ğŸŒŸ', rating:8.6, goals:16, ast:11, passAcc:77, posGroup:'ATK', attrs:{ Pace:95, Dribbling:94, Finishing:82, '1v1':93, Creativity:88 }, mini:['16 Goals','11 Assists','77% Pass'] },
  { id:'p10', name:'Federico Valverde', pos:'RM', team:'Real Madrid', avi:'âš™ï¸', rating:8.1, goals:7, ast:5, passAcc:88, posGroup:'MID', attrs:{ Pace:88, Passing:86, Shooting:80, WorkRate:95, Defending:82 }, mini:['7 Goals','5 Assists','88% Pass'] },
  { id:'p11', name:'Antonio RÃ¼diger', pos:'CB', team:'Real Madrid', avi:'ğŸ’ª', rating:7.8, goals:1, ast:0, passAcc:80, posGroup:'DEF', attrs:{ Aerial:88, Defending:90, Positioning:86, Aggression:92, Leadership:85 }, mini:['2.1 Clears/G','1.2 Int/G','80% Pass'] },
  { id:'p12', name:'Andriy Lunin', pos:'GK', team:'Real Madrid', avi:'ğŸ§¤', rating:7.6, goals:0, ast:0, passAcc:63, posGroup:'GK', attrs:{ Stopping:83, Distribution:76, Sweeping:80, Command:80, Reflexes:86 }, mini:['1.1 GA/G','68% Save','63% Pass'] },
  { id:'p13', name:'Mohamed Salah', pos:'RW', team:'Liverpool', avi:'ğŸŒ™', rating:9.0, goals:21, ast:13, passAcc:82, posGroup:'ATK', attrs:{ Pace:91, Dribbling:88, Finishing:92, Positioning:93, Creativity:90 }, mini:['21 Goals','13 Assists','92 Finish'] },
  { id:'p14', name:'Darwin NÃºÃ±ez', pos:'ST', team:'Liverpool', avi:'âš¡', rating:7.9, goals:14, ast:6, passAcc:73, posGroup:'ATK', attrs:{ Pace:94, Finishing:80, Aerial:88, Positioning:82, 'Hold-Up':78 }, mini:['14 Goals','6 Assists','94 Pace'] },
  { id:'p15', name:'Virgil van Dijk', pos:'CB', team:'Liverpool', avi:'ğŸ°', rating:8.4, goals:3, ast:2, passAcc:88, posGroup:'DEF', attrs:{ Aerial:95, Defending:92, Positioning:93, Passing:82, Leadership:96 }, mini:['0.9 GA/G','2.2 Clears/G','96 Leader'] },
  { id:'p16', name:'Alisson Becker', pos:'GK', team:'Liverpool', avi:'ğŸ§¤', rating:8.5, goals:0, ast:0, passAcc:68, posGroup:'GK', attrs:{ Stopping:94, Distribution:88, Sweeping:90, Command:91, Reflexes:92 }, mini:['0.7 GA/G','79% Save','68% Pass'] },
  { id:'p17', name:'Bukayo Saka', pos:'RW', team:'Arsenal', avi:'ğŸ’«', rating:8.7, goals:14, ast:11, passAcc:83, posGroup:'ATK', attrs:{ Dribbling:89, Shooting:86, Passing:85, Pace:87, Creativity:91 }, mini:['14 Goals','11 Assists','91 Creative'] },
  { id:'p18', name:'Declan Rice', pos:'DM', team:'Arsenal', avi:'ğŸ–ï¸', rating:8.4, goals:5, ast:6, passAcc:89, posGroup:'MID', attrs:{ Defending:89, Passing:88, Positioning:90, Stamina:92, Vision:84 }, mini:['89% Pass','2.1 Recov/G','90 Position'] },
  { id:'p19', name:'Martin Ã˜degaard', pos:'AM', team:'Arsenal', avi:'ğŸ¯', rating:8.6, goals:10, ast:13, passAcc:91, posGroup:'MID', attrs:{ Vision:95, Passing:94, Creativity:96, Dribbling:84, Shooting:82 }, mini:['10 Goals','13 Assists','91% Pass'] },
  { id:'p20', name:'Marcus Rashford', pos:'LW', team:'Manchester United', avi:'âš¡', rating:7.5, goals:9, ast:5, passAcc:78, posGroup:'ATK', attrs:{ Pace:92, Dribbling:86, Finishing:79, Directness:88, Pressing:75 }, mini:['9 Goals','5 Assists','92 Pace'] },
  { id:'p21', name:'Robert Lewandowski', pos:'ST', team:'Barcelona', avi:'ğŸ¯', rating:8.3, goals:18, ast:7, passAcc:79, posGroup:'ATK', attrs:{ Finishing:93, Positioning:94, Aerial:88, 'Hold-Up':89, Shooting:93 }, mini:['18 Goals','7 Assists','93 Finish'] },
  { id:'p22', name:'Pedri', pos:'CM', team:'Barcelona', avi:'ğŸŒ€', rating:8.5, goals:7, ast:10, passAcc:92, posGroup:'MID', attrs:{ Passing:92, Vision:91, Dribbling:90, Positioning:88, Creativity:93 }, mini:['7 Goals','10 Assists','92% Pass'] },
];

const FORMATIONS = {
  '4-3-3':  { home:[[50,400],[100,310],[185,310],[275,310],[360,310],[150,220],[255,220],[360,220],[120,110],[255,90],[390,110]], away:[[650,400],[600,310],[515,310],[425,310],[340,310],[550,220],[445,220],[340,220],[580,110],[445,90],[310,110]] },
  '4-2-3-1':{ home:[[50,400],[100,310],[185,310],[275,310],[360,310],[160,230],[300,230],[130,145],[255,130],[380,145],[255,60]], away:[[650,400],[600,310],[515,310],[425,310],[340,310],[540,230],[400,230],[570,145],[445,130],[320,145],[445,60]] },
  '4-4-2':  { home:[[50,400],[100,310],[185,310],[275,310],[360,310],[100,215],[185,215],[275,215],[360,215],[160,90],[300,90]], away:[[650,400],[600,310],[515,310],[425,310],[340,310],[600,215],[515,215],[425,215],[340,215],[540,90],[400,90]] },
  '3-5-2':  { home:[[50,400],[120,310],[230,310],[340,310],[100,215],[190,215],[285,215],[375,215],[455,215],[180,90],[340,90]], away:[[650,400],[580,310],[470,310],[360,310],[600,215],[510,215],[415,215],[325,215],[245,215],[520,90],[360,90]] },
  '3-4-3':  { home:[[50,400],[120,310],[230,310],[340,310],[100,215],[200,215],[300,215],[400,215],[120,100],[255,70],[390,100]], away:[[650,400],[580,310],[470,310],[360,310],[600,215],[500,215],[400,215],[300,215],[580,100],[445,70],[310,100]] },
  '5-3-2':  { home:[[50,400],[80,310],[175,310],[260,310],[345,310],[430,310],[170,215],[260,215],[350,215],[185,90],[335,90]], away:[[650,400],[620,310],[525,310],[440,310],[355,310],[270,310],[530,215],[440,215],[350,215],[515,90],[365,90]] },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LIVE DATA ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ fetchWithTimeout: no AbortController â€” works on ALL Android browsers â”€â”€
function fetchWithTimeout(url, ms) {
  var timeout = new Promise(function(_, reject) {
    setTimeout(function() { reject(new Error('Request timed out')); }, ms);
  });
  return Promise.race([fetch(url), timeout]);
}

function setAPIStatus(connected, msg) {
  liveConnected = connected;
  const banner = document.getElementById('apiStatusBanner');
  if (!banner) return;
  banner.style.display = 'flex';
  if (connected) {
    banner.style.cssText += 'background:rgba(0,255,135,.08);border-color:rgba(0,255,135,.3);';
    banner.innerHTML = `<span style="color:var(--accent)">ğŸŸ¢ Live Data Connected</span><span style="color:var(--text3);font-size:.65rem;margin-left:auto">Refreshing every 20s Â· ${new Date().toLocaleTimeString()}</span>`;
  } else {
    banner.style.cssText += 'background:rgba(251,146,60,.06);border-color:rgba(251,146,60,.2);';
    banner.innerHTML = `<span style="color:var(--orange)">ğŸŸ¡ Demo Data Active</span><span style="color:var(--text3);font-size:.65rem;margin-left:auto">${msg || 'Configure API in Settings â†’'}</span><button class="btn btn-secondary" style="padding:3px 10px;font-size:.65rem;margin-left:10px;" onclick="navigate('settings')">Configure</button>`;
  }
}

async function fetchLiveMatches() {
  if (!API_BASE) { setAPIStatus(false, 'No API URL set'); return; }
  try {
    const res = await fetchWithTimeout(`${API_BASE}/live`, 5000);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    renderMatchCards(data, true);
    setAPIStatus(true);
  } catch (err) {
    setAPIStatus(false, `Unreachable: ${err.message}`);
    renderMatchCards(MATCHES, false);
  }
}

async function loadMatchAnalytics(fixtureId) {
  if (!API_BASE) return;
  const bar = document.createElement('div');
  bar.style.cssText = 'position:fixed;top:52px;left:0;right:0;height:3px;z-index:9999;background:linear-gradient(90deg,transparent,var(--accent),transparent);background-size:200%;animation:shimmer 1.2s linear infinite;';
  document.body.appendChild(bar);
  try {
    const [sRes, eRes] = await Promise.allSettled([
      fetchWithTimeout(`${API_BASE}/match/${fixtureId}/stats`, 6000),
      fetchWithTimeout(`${API_BASE}/match/${fixtureId}/events`, 6000),
    ]);
    const stats = sRes.status === 'fulfilled' && sRes.value.ok ? await sRes.value.json() : null;
    const events = eRes.status === 'fulfilled' && eRes.value.ok ? await eRes.value.json() : [];
    if (stats) processMatchStats(stats, events);
  } catch(e) { console.warn('Analytics fetch:', e.message); }
  finally { bar.remove(); }
}

// â”€â”€ Tactical Calculations â”€â”€
function calculatePressing(events) {
  const p = events.filter(e => e.type === 'Pressure').length;
  return (p / Math.max(90, events.length)).toFixed(2);
}
function defensiveLineHeight(events) {
  const def = events.filter(e => e.location);
  if (!def.length) return (50 + Math.random() * 20).toFixed(1);
  const avg = def.reduce((s, e) => s + (e.location.y || 0), 0) / def.length;
  return (avg * 100).toFixed(1);
}
function calculateXT(events) {
  return events.filter(e => e.location).reduce((s, e) => s + ((e.location.x || 0) * 0.02), 0).toFixed(2);
}
function tacticalScore(data) {
  return Math.min(10, (+data.possession * 0.03 + +data.xG * 2.5 + +data.pressing * 1.5 + +data.xT * 0.3)).toFixed(1);
}
function generateInsight(m) {
  const ins = [];
  if (+m.pressing > 0.5) ins.push('High press intensity disrupting opposition build-up.');
  if (+m.defLine > 60) ins.push('Aggressive high line compressing space in final third.');
  if (+m.xT > 2) ins.push('Consistent penetration in the attacking third.');
  if (+m.pressing < 0.2) ins.push('Low press â€” organised mid-block defensive structure.');
  return ins.length ? ins.join(' ') : 'Balanced tactical structure. Monitoring for pattern emergence.';
}

function generateFakeEventData(count) {
  return Array.from({ length: Math.max(count, 10) }, (_, i) => ({
    location: { x: Math.random(), y: Math.random() },
    type: ['Shot','Pass','Pressure','Dribble'][i % 4],
    team: i % 2 === 0 ? 'home' : 'away',
  }));
}

function processMatchStats(stats, events = []) {
  const home = stats[0]?.statistics || [];
  const away = stats[1]?.statistics || [];
  const get = (arr, type) => parseInt(arr.find(s => s.type === type)?.value) || 0;
  const possession = get(home, 'Ball Possession') || 55;
  const shots = get(home, 'Total Shots');
  const shotsOn = get(home, 'Shots on Goal');
  const passAcc = get(home, 'Passes %') || 82;
  const awayShots = get(away, 'Total Shots');
  const awayShotsOn = get(away, 'Shots on Goal');
  const awayPass = get(away, 'Passes %') || 78;
  const xG = (shotsOn * 0.3 + (shots - shotsOn) * 0.1).toFixed(2);
  const awayXG = (awayShotsOn * 0.3 + (awayShots - awayShotsOn) * 0.1).toFixed(2);
  const evts = events.length ? events : generateFakeEventData(shots + awayShots);
  const pressing = calculatePressing(evts);
  const defLine = defensiveLineHeight(evts);
  const xT = calculateXT(evts);
  const score = tacticalScore({ possession, xG, pressing, xT });
  const insight = generateInsight({ pressing, defLine, xT });
  updateTacticalUI({ possession, xG, awayXG, pressing, defLine, xT, score, insight, shots, shotsOn, awayShots, awayShotsOn, passAcc, awayPass });
  const hc = document.querySelector('.heat');
  const sc = document.querySelector('.shots');
  const pc = document.querySelector('.passnet');
  if (hc) drawHeatmapFromEvents(hc, evts);
  if (sc) drawShotMapFromEvents(sc, evts);
  if (pc) drawPassNetFromEvents(pc, evts);
}

function updateTacticalUI(data) {
  const el = document.getElementById('tacticalInsight');
  if (el) el.innerHTML = `
    <div style="font-size:.78rem;color:var(--text);line-height:1.65;margin-bottom:10px;">${data.insight}</div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;">
      ${[['Score',data.score+'/10','var(--accent)'],['Press/min',data.pressing,'var(--blue)'],['Def Line',data.defLine+'m','var(--orange)'],['xT',data.xT,'var(--purple)'],['xG Home',data.xG,'var(--accent)'],['xG Away',data.awayXG,'var(--red)']].map(([l,v,c])=>`
      <div style="background:var(--s4);border-radius:6px;padding:7px;text-align:center;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1rem;color:${c}">${v}</div>
        <div style="font-size:.58rem;color:var(--text3);text-transform:uppercase;letter-spacing:.4px">${l}</div>
      </div>`).join('')}
    </div>`;
  const lsp = document.getElementById('liveStatsPanel');
  if (lsp && data.shots !== undefined) {
    lsp.innerHTML = `<div class="card-title" style="margin-top:12px">âš¡ Live Statistics</div>` +
      [['Possession',data.possession+'%',(100-data.possession)+'%',data.possession],['Shots',data.shots,data.awayShots,Math.round(data.shots/(data.shots+data.awayShots||1)*100)],['On Target',data.shotsOn,data.awayShotsOn,Math.round(data.shotsOn/(data.shotsOn+data.awayShotsOn||1)*100)],['xG',data.xG,data.awayXG,Math.round(+data.xG/(+data.xG+ +data.awayXG||1)*100)],['Pass Acc.',data.passAcc+'%',data.awayPass+'%',data.passAcc]].map(([l,h,a,pct])=>`
      <div class="cmp-row" style="margin-bottom:8px">
        <div class="cmp-hd"><span class="cmp-l">${h}</span><span class="cmp-lbl">${l}</span><span class="cmp-r">${a}</span></div>
        <div class="cmp-track"><div class="cmp-left" style="width:${pct||50}%"></div><div class="cmp-right"></div></div>
      </div>`).join('');
  }
}

// â”€â”€ Canvas Visuals â”€â”€
function drawHeatmapFromEvents(canvas, events) {
  const W = canvas.width = canvas.offsetWidth || 600;
  const H = canvas.height || 300;
  const ctx = canvas.getContext('2d');
  for(let i=0;i<12;i++){ctx.fillStyle=i%2===0?'#1e9148':'#197a3d';ctx.fillRect(i*(W/12),0,W/12,H);}
  ctx.strokeStyle='rgba(255,255,255,.4)';ctx.lineWidth=1.5;
  ctx.strokeRect(14,14,W-28,H-28);ctx.beginPath();ctx.moveTo(W/2,14);ctx.lineTo(W/2,H-14);ctx.stroke();
  ctx.beginPath();ctx.arc(W/2,H/2,50,0,Math.PI*2);ctx.stroke();
  ctx.strokeRect(14,H/2-55,95,110);ctx.strokeRect(W-109,H/2-55,95,110);
  events.forEach(e => {
    if (!e.location) return;
    const x=e.location.x*W, y=e.location.y*H, r=30+Math.random()*18;
    const grd=ctx.createRadialGradient(x,y,0,x,y,r);
    const c=e.team==='home'?'0,255,135':'244,63,94';
    grd.addColorStop(0,`rgba(${c},.45)`);grd.addColorStop(1,`rgba(${c},0)`);
    ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fillStyle=grd;ctx.fill();
  });
}

function drawShotMapFromEvents(canvas, events) {
  const W=canvas.width=canvas.offsetWidth||600, H=canvas.height||300;
  const ctx=canvas.getContext('2d');
  for(let i=0;i<6;i++){ctx.fillStyle=i%2===0?'#1e9148':'#197a3d';ctx.fillRect(i*(W/6),0,W/6,H);}
  ctx.strokeStyle='rgba(255,255,255,.35)';ctx.lineWidth=1.5;
  ctx.strokeRect(14,14,W-28,H-28);
  ctx.strokeRect(W-120,H/2-62,106,124);ctx.strokeRect(W-52,H/2-30,38,60);
  ctx.strokeRect(14,H/2-62,106,124);ctx.strokeRect(14,H/2-30,38,60);
  events.forEach(e => {
    if (!e.location) return;
    const x=e.location.x*W, y=e.location.y*H, r=5+Math.random()*9;
    const isHome=e.team==='home';
    ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fillStyle=isHome?'rgba(56,189,248,.6)':'rgba(244,63,94,.6)';
    ctx.strokeStyle=isHome?'#38bdf8':'#f43f5e';ctx.lineWidth=1.5;
    ctx.fill();ctx.stroke();
  });
  ctx.fillStyle='rgba(255,255,255,.35)';ctx.font='10px Barlow Condensed';ctx.textAlign='left';
  ctx.fillText('â— Home   â— Away   Size = xG',18,H-8);
}

function drawPassNetFromEvents(canvas, events) {
  const W=canvas.width=canvas.offsetWidth||600, H=canvas.height||300;
  const ctx=canvas.getContext('2d');
  for(let i=0;i<12;i++){ctx.fillStyle=i%2===0?'#1e9148':'#197a3d';ctx.fillRect(i*(W/12),0,W/12,H);}
  ctx.strokeStyle='rgba(255,255,255,.3)';ctx.lineWidth=1;
  ctx.strokeRect(14,14,W-28,H-28);ctx.beginPath();ctx.moveTo(W/2,14);ctx.lineTo(W/2,H-14);ctx.stroke();
  for(let i=0;i<events.length-1;i++){
    const a=events[i],b=events[i+1];
    if(!a.location||!b.location)continue;
    ctx.beginPath();ctx.moveTo(a.location.x*W,a.location.y*H);ctx.lineTo(b.location.x*W,b.location.y*H);
    ctx.strokeStyle=`rgba(56,189,248,${.15+Math.random()*.35})`;ctx.lineWidth=.8+Math.random()*2;ctx.stroke();
  }
  events.forEach(e=>{
    if(!e.location)return;
    ctx.beginPath();ctx.arc(e.location.x*W,e.location.y*H,4,0,Math.PI*2);
    ctx.fillStyle=e.team==='home'?'rgba(0,255,135,.85)':'rgba(244,63,94,.85)';ctx.fill();
  });
}

// â”€â”€ Polling â”€â”€
function startLivePolling(interval) {
  fetchLiveMatches();
  if (livePollingInterval) clearInterval(livePollingInterval);
  livePollingInterval = setInterval(fetchLiveMatches, interval || 20000);
}
function stopLivePolling() {
  if (livePollingInterval) { clearInterval(livePollingInterval); livePollingInterval = null; }
}

// â”€â”€ Toast â”€â”€
function showToast(msg, type='info') {
  const colors={info:'var(--blue)',success:'var(--accent)',error:'var(--red)'};
  const t=document.createElement('div');
  t.style.cssText=`position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--s2);border:1px solid ${colors[type]};color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.78rem;padding:10px 18px;border-radius:8px;z-index:9999;white-space:nowrap;animation:fadeUp .3s ease;box-shadow:0 4px 24px rgba(0,0,0,.4);`;
  t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),3200);
}

// â”€â”€ API Settings â”€â”€
function saveAPISettings() {
  const inp=document.getElementById('apiBaseInput');
  if(!inp)return;
  API_BASE=inp.value.trim().replace(/\/$/,'');
  localStorage.setItem('tacticaiq_api',API_BASE);
  const iv=parseInt(document.getElementById('pollInterval')?.value)||20000;
  startLivePolling(iv);
  showToast('Saved. Connectingâ€¦','info');
}
function testAPIConnection() {
  const inp=document.getElementById('apiBaseInput');
  const url=(inp?.value||API_BASE).trim().replace(/\/$/,'');
  if(!url){showToast('Enter an API URL first','error');return;}
  const btn=document.getElementById('testAPIBtn');
  if(btn){btn.textContent='Testingâ€¦';btn.disabled=true;}
  fetchWithTimeout(`${url}/live`, 5000)
    .then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);showToast('âœ… Connection successful!','success');})
    .catch(e=>showToast(`âŒ Failed: ${e.message}`,'error'))
    .finally(()=>{if(btn){btn.textContent='Test Connection';btn.disabled=false;}});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function navigate(page, id=null) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.snav-item,.bnav-item').forEach(b=>b.classList.remove('active'));
  const mainPage = page.split('-')[0];
  document.querySelectorAll(`[data-page="${mainPage}"]`).forEach(b=>b.classList.add('active'));
  if (page==='match' && id) {
    document.getElementById('page-match').classList.add('active');
    renderMatchDetail(id);
  } else if (page==='player' && id) {
    document.getElementById('page-player').classList.add('active');
    renderPlayerDetail(id);
  } else {
    const el=document.getElementById('page-'+page);
    if(el) el.classList.add('active');
  }
  currentPage=page;
  if(page==='formations') setTimeout(renderTacticPitch,50);
  if(page==='reports') renderReports();
  if(page==='players') renderPlayersList();
  if(page==='home') renderHome();
  if(page==='matches') renderMatches();
  if(page==='settings') setTimeout(renderSettingsAPIPanel,50);
  document.getElementById('main').scrollTop=0;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHome() {
  // Build status banner if missing
  const heroParent = document.querySelector('.hero-band')?.parentNode;
  if (heroParent && !document.getElementById('apiStatusBanner')) {
    const banner = document.createElement('div');
    banner.id = 'apiStatusBanner';
    banner.style.cssText = 'display:flex;align-items:center;gap:8px;border:1px solid;border-radius:8px;padding:8px 12px;margin-bottom:10px;font-size:.72rem;font-family:"JetBrains Mono",monospace;';
    heroParent.insertBefore(banner, heroParent.firstChild);
  }

  const matchList = document.getElementById('homeMatchList');
  if (matchList) matchList.innerHTML = MATCHES.slice(0,3).map(m => matchCardHTML(m)).join('');

  const top = document.getElementById('homeTopPlayers');
  if (top) {
    const topPlayers = [...PLAYERS].sort((a,b)=>b.rating-a.rating).slice(0,4);
    top.innerHTML = topPlayers.map(p=>`
      <div class="player-card" onclick="navigate('player','${p.id}')">
        <div class="pc-avi">${p.avi}</div>
        <div class="pc-info">
          <div class="pc-name">${p.name}</div>
          <div class="pc-detail"><span class="tag tag-${posTagClass(p.posGroup)}">${p.pos}</span>${p.team}</div>
        </div>
        <div class="pc-rating" style="color:${ratingColor(p.rating)}">${p.rating}</div>
      </div>`).join('');
  }

  // After render, update status and optionally start polling
  setAPIStatus(false, API_BASE ? 'Connectingâ€¦' : 'Configure API in Settings â†’');
  if (API_BASE) startLivePolling();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MATCHES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function matchCardHTML(m) {
  return `
  <div class="match-card" onclick="navigate('match','${m.id}')">
    <div class="mc-comp">
      <span>${m.comp} Â· ${m.date}</span>
      <span class="tag tag-${m.status==='finished'?'blue':'red'}">${m.status==='finished'?'FT':'LIVE'}</span>
    </div>
    <div class="mc-teams">
      <div class="mc-team-name home">${m.home}</div>
      <div class="mc-score">${m.homeScore} â€” ${m.awayScore}</div>
      <div class="mc-team-name away">${m.away}</div>
    </div>
    <div class="mc-footer">
      <div class="mc-stats">
        <div class="mc-stat">xG <span>${m.stats.xg[0]}â€“${m.stats.xg[1]}</span></div>
        <div class="mc-stat">Shots <span>${m.stats.shots[0]}â€“${m.stats.shots[1]}</span></div>
        <div class="mc-stat">Poss <span>${m.stats.possession[0]}%</span></div>
      </div>
      <div class="mc-action">Analyse â†’</div>
    </div>
  </div>`;
}

// Used by live engine to render API cards or fall back to static
function renderMatchCards(data, isLive) {
  const container = document.getElementById('homeMatchList');
  if (!container) return;
  if (!isLive || !data?.length) {
    container.innerHTML = MATCHES.slice(0,3).map(m=>matchCardHTML(m)).join('');
    return;
  }
  container.innerHTML = data.map(match=>`
    <div class="match-card" onclick="loadMatchAnalytics(${match.fixture.id})">
      <div class="mc-comp">
        <span>${match.league?.name||'Live Match'}</span>
        <span class="tag tag-red"><span style="display:inline-block;width:5px;height:5px;border-radius:50%;background:var(--red);margin-right:3px;animation:pulse 1.2s infinite;vertical-align:middle;"></span>LIVE ${match.fixture?.status?.elapsed||0}'</span>
      </div>
      <div class="mc-teams">
        <div class="mc-team-name home">${match.teams?.home?.name||'Home'}</div>
        <div class="mc-score">${match.goals?.home??0} â€” ${match.goals?.away??0}</div>
        <div class="mc-team-name away">${match.teams?.away?.name||'Away'}</div>
      </div>
      <div class="mc-footer">
        <div class="mc-stats"><div class="mc-stat">Min <span>${match.fixture?.status?.elapsed||0}'</span></div></div>
        <div class="mc-action">Analyse â†’</div>
      </div>
    </div>`).join('');
}

function renderMatches() {
  const el=document.getElementById('matchesList');
  if(el) el.innerHTML=MATCHES.map(m=>matchCardHTML(m)).join('');
}
function filterMatches(el, key) {
  document.querySelectorAll('#page-matches .tab-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  const filtered=key==='all'?MATCHES:MATCHES.filter(m=>m.compKey===key);
  const cont=document.getElementById('matchesList');
  if(cont) cont.innerHTML=filtered.map(m=>matchCardHTML(m)).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MATCH DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMatchDetail(id) {
  const m=MATCHES.find(x=>x.id===id);
  if(!m)return;
  document.getElementById('matchDetailContent').innerHTML=`
    <div style="background:var(--s2);border:1px solid var(--border);border-radius:var(--radius);padding:16px 20px;margin-bottom:12px;">
      <div style="font-size:.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">${m.comp} Â· ${m.date}</div>
      <div style="display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px;margin-bottom:10px;">
        <div><div style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:1px;">${m.home}</div><div style="font-size:.65rem;color:var(--text2);">ğŸ© ${m.homeManager} Â· ${m.homeFormation}</div></div>
        <div style="text-align:center;"><div style="font-family:'Bebas Neue',sans-serif;font-size:2.8rem;color:var(--accent);letter-spacing:5px;line-height:1;text-shadow:var(--accent-glow);">${m.homeScore} â€” ${m.awayScore}</div><div style="font-size:.62rem;color:var(--text3);margin-top:2px;">${m.minute}</div></div>
        <div style="text-align:right;"><div style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:1px;">${m.away}</div><div style="font-size:.65rem;color:var(--text2);">${m.awayFormation} Â· ${m.awayManager} ğŸ§£</div></div>
      </div>
      <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;">
        ${[['Possession',m.stats.possession[0]+'%',m.stats.possession[1]+'%'],['xG',m.stats.xg[0],m.stats.xg[1]],['Shots',m.stats.shots[0],m.stats.shots[1]],['On Target',m.stats.onTarget[0],m.stats.onTarget[1]],['Pass Acc.',m.stats.passAcc[0]+'%',m.stats.passAcc[1]+'%'],['Corners',m.stats.corners[0],m.stats.corners[1]]].map(([l,h,a])=>`<div style="font-size:.65rem;color:var(--text2);">${l}: <span style="color:var(--blue)">${h}</span>â€“<span style="color:var(--red)">${a}</span></div>`).join('')}
      </div>
    </div>
    <div class="tab-bar" id="matchTabs_${id}">
      <button class="tab-btn active" onclick="switchMatchTab(this,'overview','${id}')">Overview</button>
      <button class="tab-btn" onclick="switchMatchTab(this,'heatmap','${id}')">Heatmap</button>
      <button class="tab-btn" onclick="switchMatchTab(this,'shotmap','${id}')">Shot Map</button>
      <button class="tab-btn" onclick="switchMatchTab(this,'passing','${id}')">Pass Network</button>
      <button class="tab-btn" onclick="switchMatchTab(this,'timeline','${id}')">Timeline</button>
      <button class="tab-btn" onclick="switchMatchTab(this,'stats','${id}')">Stats</button>
    </div>
    <div id="matchTabContent_${id}"></div>
    <div id="tacticalInsightPanel" class="card" style="margin-top:12px;">
      <div class="card-title">ğŸ¤– AI Tactical Engine</div>
      <div id="tacticalInsight">
        <div style="color:var(--text3);font-size:.75rem;">${API_BASE?'Fetching live tactical analysisâ€¦':'Connect your API in Settings to enable live insights.'}<br><br>
        <span style="color:var(--text2)">Demo: High press triggering at opponent GK. Left flank overload active. Tactical Score: <strong style="color:var(--accent)">7.4/10</strong>. Def Line: <strong style="color:var(--orange)">68m</strong>. xT: <strong style="color:var(--purple)">2.41</strong>.</span></div>
      </div>
      <div id="liveStatsPanel"></div>
    </div>`;
  switchMatchTab(document.querySelector(`#matchTabs_${id} .tab-btn`), 'overview', id);
  if (API_BASE) setTimeout(()=>loadMatchAnalytics(id),200);
}

function switchMatchTab(el, tab, id) {
  const tabBar = document.getElementById('matchTabs_'+id);
  if(tabBar) tabBar.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  if(el) el.classList.add('active');
  const m=MATCHES.find(x=>x.id===id);
  const content=document.getElementById('matchTabContent_'+id);
  if(!content||!m)return;

  if(tab==='overview') {
    content.innerHTML=`
      <div class="pitch-wrap">
        <div class="pitch-wrap-hd">
          <span class="card-title" style="margin-bottom:0">Tactical Board</span>
          <div class="ptab-group">
            <div class="ptab active" onclick="setPitchLayer(this,'press_layer','mp_${id}')">Formation</div>
            <div class="ptab" onclick="setPitchLayer(this,'space_layer','mp_${id}')">Space</div>
            <div class="ptab" onclick="setPitchLayer(this,'pass_layer','mp_${id}')">Pass Map</div>
          </div>
        </div>
        <svg id="mp_${id}" class="pitch" viewBox="0 0 700 450"></svg>
      </div>
      <div class="grid2">
        <div class="card">
          <div class="card-title">Tactical Patterns</div>
          ${m.patterns.map(p=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 10px;background:var(--s3);border-radius:5px;margin-bottom:5px;border-left:3px solid var(--border);cursor:pointer;transition:all .2s;" onmouseenter="this.style.borderLeftColor='var(--blue)'" onmouseleave="this.style.borderLeftColor='var(--border)'"><span style="font-size:.75rem;">${p.split(' (')[0]}</span><span style="font-size:.68rem;color:var(--blue);">${p.match(/\(([^)]+)\)/)?.[1]||''}</span></div>`).join('')}
        </div>
        <div class="card">
          <div class="card-title">Win Probability</div>
          <div class="prob-nums"><span style="color:var(--blue)">${m.winProb[0]}%</span><span style="color:var(--text3);font-size:.9rem">${m.winProb[1]}%</span><span style="color:var(--red)">${m.winProb[2]}%</span></div>
          <div class="prob-bar"><div class="prob-h" style="width:${m.winProb[0]}%"></div><div class="prob-d" style="width:${m.winProb[1]}%"></div><div class="prob-a"></div></div>
          <div style="display:flex;justify-content:space-between;font-size:.62rem;color:var(--text3);"><span>${m.home}</span><span>Draw</span><span>${m.away}</span></div>
          <div style="margin-top:12px">
            ${[['Possession',m.stats.possession[0],m.stats.possession[1]],['Shots',m.stats.shots[0],m.stats.shots[1]],['xG',(m.stats.xg[0]*100/4.5).toFixed(0),(m.stats.xg[1]*100/4.5).toFixed(0)],['Pass Acc.',m.stats.passAcc[0],m.stats.passAcc[1]]].map(([l,h,a])=>`
            <div class="cmp-row"><div class="cmp-hd"><span class="cmp-l">${h}</span><span class="cmp-lbl">${l}</span><span class="cmp-r">${a}</span></div><div class="cmp-track"><div class="cmp-left" style="width:${Math.round(+h/(+h+ +a)*100)}%"></div><div class="cmp-right"></div></div></div>`).join('')}
          </div>
        </div>
      </div>`;
    setTimeout(()=>renderMatchPitch('mp_'+id, m.homeFormation, m.awayFormation),60);
  } else if(tab==='heatmap') {
    content.innerHTML=`<div class="card"><div class="card-title">Heatmap</div><div style="display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap;"><button class="ptab active" onclick="setHeatTeam(this,'home','hmc_${id}')">ğŸ”µ ${m.home}</button><button class="ptab" onclick="setHeatTeam(this,'away','hmc_${id}')">ğŸ”´ ${m.away}</button><button class="ptab" onclick="setHeatTeam(this,'both','hmc_${id}')">Both</button></div><div class="heat-canvas-box"><canvas id="hmc_${id}" class="heat" height="300"></canvas></div></div>
    <div class="grid2" style="margin-top:12px">${[['Zone Breakdown',[['Final Third','38%',38,'g'],['Middle Third','44%',44,'b'],['Defensive Third','18%',18,'o'],['Left Corridor','42%',42,'g'],['Right Corridor','23%',23,'b']]],['Movement Data',[['Total Distance','62.4 km',78,'g'],['High Intensity','148 runs',74,'b'],['Sprints >25km/h','89',59,'o'],['Max Speed','34.2 km/h',85,'b'],['Pressing Actions','41',68,'r']]]].map(([title,bars])=>`<div class="card"><div class="card-title">${title}</div>${bars.map(([l,v,w,c])=>`<div class="sbar"><div class="sbar-row"><span class="lbl">${l}</span><span class="val">${v}</span></div><div class="sbar-track"><div class="sbar-fill fill-${c}" style="width:${w}%"></div></div></div>`).join('')}</div>`).join('')}</div>`;
    setTimeout(()=>drawMatchHeatmap('hmc_'+id,'home'),50);
  } else if(tab==='shotmap') {
    content.innerHTML=`<div class="card"><div class="card-title">Shot Map with xG</div><canvas id="smc_${id}" height="320" style="width:100%;display:block;border-radius:6px;"></canvas><div style="display:flex;gap:14px;margin-top:8px;flex-wrap:wrap;font-size:.68rem;color:var(--text2);"><div>ğŸ”µ ${m.home}: ${m.stats.shots[0]} shots, ${m.stats.onTarget[0]} on target, xG ${m.stats.xg[0]}</div><div>ğŸ”´ ${m.away}: ${m.stats.shots[1]} shots, ${m.stats.onTarget[1]} on target, xG ${m.stats.xg[1]}</div></div></div>`;
    setTimeout(()=>drawShotMap('smc_'+id,m),50);
  } else if(tab==='passing') {
    content.innerHTML=`<div class="card"><div class="card-title">Passing Network</div><canvas id="pnc_${id}" height="320" style="width:100%;display:block;border-radius:6px;"></canvas><div style="font-size:.68rem;color:var(--text2);margin-top:6px;">Node size = passes received Â· Line thickness = frequency</div></div>`;
    setTimeout(()=>drawPassNetwork('pnc_'+id,m),50);
  } else if(tab==='timeline') {
    content.innerHTML=`<div class="card"><div class="card-title">Match Events</div><div class="timeline">${m.events.map(e=>`<div class="tl-event ev-${e.type}"><span class="tl-min">${e.min}'</span><span class="tl-name">${e.player}</span><span class="tl-desc"> â€” ${e.desc}</span></div>`).join('')}</div></div>
    <div class="card" style="margin-top:12px"><div class="card-title">Match Momentum</div><canvas id="mom_${id}" height="120" style="width:100%;display:block;border-radius:6px;"></canvas></div>`;
    setTimeout(()=>drawMomentum('mom_'+id,m),50);
  } else if(tab==='stats') {
    content.innerHTML=`<div class="card"><div class="card-title">Full Statistics</div>${[['Possession',m.stats.possession[0]+'%',m.stats.possession[1]+'%',m.stats.possession[0]],['Shots',m.stats.shots[0],m.stats.shots[1],m.stats.shots[0]/(m.stats.shots[0]+m.stats.shots[1])*100],['On Target',m.stats.onTarget[0],m.stats.onTarget[1],m.stats.onTarget[0]/(m.stats.onTarget[0]+m.stats.onTarget[1])*100],['xG',m.stats.xg[0],m.stats.xg[1],m.stats.xg[0]/(+m.stats.xg[0]+ +m.stats.xg[1])*100],['Pass Acc.',m.stats.passAcc[0]+'%',m.stats.passAcc[1]+'%',m.stats.passAcc[0]],['Corners',m.stats.corners[0],m.stats.corners[1],m.stats.corners[0]/(m.stats.corners[0]+m.stats.corners[1])*100],['Fouls',m.stats.fouls[0],m.stats.fouls[1],m.stats.fouls[0]/(m.stats.fouls[0]+m.stats.fouls[1])*100]].map(([l,h,a,pct])=>`<div class="cmp-row" style="margin-bottom:10px"><div class="cmp-hd"><span class="cmp-l">${h}</span><span class="cmp-lbl">${l}</span><span class="cmp-r">${a}</span></div><div class="cmp-track"><div class="cmp-left" style="width:${Math.round(pct)}%"></div><div class="cmp-right"></div></div></div>`).join('')}</div>
    <div class="grid2" style="margin-top:12px"><div class="mgr-card"><div class="mgr-top"><div class="mgr-avi">ğŸ©</div><div><div class="mgr-name">${m.homeManager}</div><div class="mgr-club">${m.home}</div><div class="mgr-rec">${m.homeFormation}</div></div></div>${[['Tactical Setup',92],['Press Design',96],['In-Game Decisions',87]].map(([l,v])=>`<div class="sbar"><div class="sbar-row"><span class="lbl">${l}</span><span class="val">${v}</span></div><div class="sbar-track"><div class="sbar-fill fill-g" style="width:${v}%"></div></div></div>`).join('')}</div><div class="mgr-card"><div class="mgr-top"><div class="mgr-avi">ğŸ§£</div><div><div class="mgr-name">${m.awayManager}</div><div class="mgr-club">${m.away}</div><div class="mgr-rec">${m.awayFormation}</div></div></div>${[['Tactical Setup',78],['In-Game Decisions',82],['Big Game Exp.',88]].map(([l,v])=>`<div class="sbar"><div class="sbar-row"><span class="lbl">${l}</span><span class="val">${v}</span></div><div class="sbar-track"><div class="sbar-fill fill-b" style="width:${v}%"></div></div></div>`).join('')}</div></div>`;
  }
}

function setPitchLayer(el, layer, svgId) {
  const svg=document.getElementById(svgId); if(!svg)return;
  document.querySelectorAll('.ptab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  ['space_layer','pass_layer','press_layer'].forEach(l=>{const n=svg.querySelector('#'+l);if(n)n.style.opacity='0';});
  const t=svg.querySelector('#'+layer); if(t)t.style.opacity='1';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PITCH SVG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pitchBase(uid) {
  return `<defs>
    <pattern id="s${uid}" x="0" y="0" width="58" height="450" patternUnits="userSpaceOnUse">
      <rect width="29" height="450" fill="#1e9148"/><rect x="29" width="29" height="450" fill="#197a3d"/>
    </pattern>
    <radialGradient id="hr${uid}" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#f43f5e" stop-opacity=".55"/><stop offset="100%" stop-color="#f43f5e" stop-opacity="0"/></radialGradient>
    <radialGradient id="hb${uid}" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#38bdf8" stop-opacity=".55"/><stop offset="100%" stop-color="#38bdf8" stop-opacity="0"/></radialGradient>
    <marker id="arr${uid}" markerWidth="7" markerHeight="7" refX="5" refY="3.5" orient="auto"><polygon points="0 0,7 3.5,0 7" fill="rgba(255,255,255,.5)"/></marker>
  </defs>
  <rect width="700" height="450" fill="url(#s${uid})" rx="6"/>
  <g stroke="rgba(255,255,255,.45)" stroke-width="1.5" fill="none">
    <rect x="22" y="22" width="656" height="406"/><line x1="350" y1="22" x2="350" y2="428"/>
    <circle cx="350" cy="225" r="58"/><circle cx="350" cy="225" r="3" fill="rgba(255,255,255,.45)"/>
    <rect x="22" y="138" width="110" height="174"/><rect x="22" y="178" width="36" height="94"/>
    <circle cx="92" cy="225" r="2.5" fill="rgba(255,255,255,.45)"/>
    <rect x="568" y="138" width="110" height="174"/><rect x="642" y="178" width="36" height="94"/>
    <circle cx="608" cy="225" r="2.5" fill="rgba(255,255,255,.45)"/>
    <rect x="4" y="198" width="18" height="54"/><rect x="678" y="198" width="18" height="54"/>
    <path d="M22 34 A12 12 0 0 1 34 22"/><path d="M666 22 A12 12 0 0 1 678 34"/>
    <path d="M678 416 A12 12 0 0 1 666 428"/><path d="M34 428 A12 12 0 0 1 22 416"/>
  </g>
  <g id="space_layer" opacity="0" style="transition:opacity .4s">
    <rect x="205" y="78" width="148" height="108" fill="rgba(0,255,135,.1)" stroke="rgba(0,255,135,.4)" stroke-width="1" stroke-dasharray="5,4"/>
    <text x="279" y="137" text-anchor="middle" fill="rgba(0,255,135,.8)" font-size="10" font-family="Barlow Condensed">FREE SPACE</text>
    <rect x="388" y="268" width="125" height="97" fill="rgba(251,146,60,.1)" stroke="rgba(251,146,60,.4)" stroke-width="1" stroke-dasharray="5,4"/>
    <text x="450" y="320" text-anchor="middle" fill="rgba(251,146,60,.8)" font-size="10" font-family="Barlow Condensed">EXPOSED</text>
  </g>
  <g id="pass_layer" opacity="0" style="transition:opacity .4s">
    <line x1="92" y1="225" x2="207" y2="165" stroke="rgba(56,189,248,.5)" stroke-width="2" marker-end="url(#arr${uid})"/>
    <line x1="207" y1="165" x2="352" y2="145" stroke="rgba(56,189,248,.6)" stroke-width="2.5" marker-end="url(#arr${uid})"/>
    <line x1="352" y1="145" x2="492" y2="122" stroke="rgba(56,189,248,.7)" stroke-width="3" marker-end="url(#arr${uid})"/>
    <line x1="492" y1="122" x2="600" y2="192" stroke="rgba(251,146,60,.6)" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arr${uid})"/>
  </g>
  <g id="press_layer" opacity="1" style="transition:opacity .4s">
    <ellipse cx="312" cy="225" rx="44" ry="37" fill="none" stroke="rgba(251,146,60,.4)" stroke-width="1.5" stroke-dasharray="5,4"/>
    <ellipse cx="475" cy="225" rx="58" ry="52" fill="none" stroke="rgba(0,255,135,.22)" stroke-width="1.5" stroke-dasharray="5,4"/>
  </g>`;
}

function renderMatchPitch(svgId, homeForm, awayForm) {
  const svg=document.getElementById(svgId); if(!svg)return;
  const uid=svgId.replace(/[^a-z0-9]/gi,'');
  svg.innerHTML=pitchBase(uid)+'<g id="pl_'+uid+'"></g>';
  const g=document.getElementById('pl_'+uid); if(!g)return;
  const hPos=FORMATIONS[homeForm]?.home||FORMATIONS['4-3-3'].home;
  const aPos=FORMATIONS[awayForm]?.away||FORMATIONS['4-2-3-1'].away;
  const hNums=[1,2,5,25,24,16,17,20,26,9,11];
  const aNums=[13,2,3,22,23,18,12,8,5,9,7];
  const hNames=['GK','RB','CB','CB','LB','DM','CM','CM','RW','ST','LW'];
  const aNames=['GK','RB','CB','CB','LB','DM','DM','RM','AM','CF','LM'];
  const render=(nums,pos,names,fill,stroke)=>{
    pos.forEach(([x,y],i)=>{
      const star=i===9||i===8||i===6;
      const r=star?13:11, sc=star?'#fbbf24':stroke, sw=star?2.5:1.8;
      const el=document.createElementNS('http://www.w3.org/2000/svg','g');
      el.setAttribute('style','cursor:pointer');
      el.innerHTML=`<circle cx="${x}" cy="${y+1}" r="${r+1}" fill="rgba(0,0,0,.4)"/><circle cx="${x}" cy="${y}" r="${r}" fill="${fill}" stroke="${sc}" stroke-width="${sw}"/><text x="${x}" y="${y+4}" text-anchor="middle" fill="white" font-size="8" font-weight="bold" font-family="Barlow Condensed">${nums[i]||''}</text><text x="${x}" y="${y+r+11}" text-anchor="middle" fill="rgba(255,255,255,.8)" font-size="7.5" font-family="Barlow Condensed">${names[i]||''}</text>`;
      g.appendChild(el);
    });
  };
  render(hNums,hPos,hNames,'#1d4ed8','#60a5fa');
  render(aNums,aPos,aNames,'#7f1d1d','#fca5a5');
}

function renderTacticPitch() {
  renderMatchPitch('tacticSVG', tacticHomeForm, tacticAwayForm);
  const svg=document.getElementById('tacticSVG'); if(!svg)return;
  const layers={pressure:'press_layer',pass:'pass_layer',space:'space_layer'};
  Object.entries(layers).forEach(([k,id])=>{
    const l=svg.querySelector('#'+id); if(l)l.style.opacity=tacticOverlays[k]?'1':'0';
  });
}
function setTacticFormation(side,form){
  if(side==='home')tacticHomeForm=form; else tacticAwayForm=form;
  renderTacticPitch();
}
function tacticToggle(el,type){
  el.classList.toggle('on');
  tacticOverlays[type]=el.classList.contains('on');
  renderTacticPitch();
}
function updateTacticLabel(input,labelId,options){
  document.getElementById(labelId).textContent=options[+input.value-1];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CANVAS CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawMatchHeatmap(canvasId, team) {
  const canvas=document.getElementById(canvasId); if(!canvas)return;
  const W=canvas.width=canvas.offsetWidth||700, H=canvas.height=300;
  const ctx=canvas.getContext('2d');
  for(let i=0;i<12;i++){ctx.fillStyle=i%2===0?'#1e9148':'#197a3d';ctx.fillRect(i*(W/12),0,W/12,H);}
  ctx.strokeStyle='rgba(255,255,255,.4)';ctx.lineWidth=1.5;
  ctx.strokeRect(16,16,W-32,H-32);ctx.beginPath();ctx.moveTo(W/2,16);ctx.lineTo(W/2,H-16);ctx.stroke();
  ctx.beginPath();ctx.arc(W/2,H/2,50,0,Math.PI*2);ctx.stroke();
  ctx.strokeRect(16,H/2-60,95,120);ctx.strokeRect(W-111,H/2-60,95,120);
  const hB=[{x:.18,y:.5,rx:.12,ry:.18,c:[56,189,248],a:.75},{x:.32,y:.45,rx:.1,ry:.14,c:[0,255,135],a:.65},{x:.46,y:.5,rx:.14,ry:.2,c:[56,189,248],a:.8},{x:.62,y:.5,rx:.11,ry:.16,c:[251,146,60],a:.6}];
  const aB=[{x:.82,y:.5,rx:.12,ry:.18,c:[244,63,94],a:.75},{x:.68,y:.45,rx:.1,ry:.14,c:[251,146,60],a:.65},{x:.54,y:.5,rx:.14,ry:.2,c:[244,63,94],a:.75},{x:.38,y:.5,rx:.11,ry:.16,c:[244,63,94],a:.55}];
  const blobs=team==='home'?hB:team==='away'?aB:[...hB,...aB];
  blobs.forEach(({x,y,rx,ry,c,a})=>{
    const grd=ctx.createRadialGradient(x*W,y*H,0,x*W,y*H,rx*W);
    grd.addColorStop(0,`rgba(${c[0]},${c[1]},${c[2]},${a})`);grd.addColorStop(.5,`rgba(${c[0]},${c[1]},${c[2]},${a*.5})`);grd.addColorStop(1,`rgba(${c[0]},${c[1]},${c[2]},0)`);
    ctx.save();ctx.scale(1,ry/rx);ctx.beginPath();ctx.arc(x*W,y*H/(ry/rx),rx*W,0,Math.PI*2);ctx.fillStyle=grd;ctx.fill();ctx.restore();
  });
}
function setHeatTeam(el, team, cId) {
  document.querySelectorAll('[onclick*="setHeatTeam"]').forEach(b=>b.classList.remove('active'));
  el.classList.add('active'); drawMatchHeatmap(cId,team);
}

function drawShotMap(canvasId, m) {
  const canvas=document.getElementById(canvasId); if(!canvas)return;
  const W=canvas.width=canvas.offsetWidth||700, H=canvas.height=320;
  const ctx=canvas.getContext('2d');
  for(let i=0;i<6;i++){ctx.fillStyle=i%2===0?'#1e9148':'#197a3d';ctx.fillRect(i*(W/6),0,W/6,H);}
  ctx.strokeStyle='rgba(255,255,255,.4)';ctx.lineWidth=1.5;
  ctx.strokeRect(16,16,W-32,H-32);ctx.strokeRect(16,H/2-65,108,130);ctx.strokeRect(16,H/2-32,38,64);
  ctx.strokeRect(W-124,H/2-65,108,130);ctx.strokeRect(W-54,H/2-32,38,64);
  ctx.beginPath();ctx.arc(W*.88,H/2,55,Math.PI*.5,Math.PI*1.5);ctx.stroke();
  ctx.beginPath();ctx.arc(W*.12,H/2,55,Math.PI*1.5,Math.PI*.5);ctx.stroke();
  ctx.strokeRect(W-16,H/2-27,16,54);ctx.strokeRect(0,H/2-27,16,54);
  const seed=m.id.charCodeAt(m.id.length-1);
  const hShots=Array.from({length:m.stats.shots[0]},(_,i)=>({x:W*.62+Math.sin(i*3.7+seed)*.28*W,y:H*.3+Math.cos(i*2.3+seed)*.4*H,xg:.05+Math.abs(Math.sin(i*1.7+seed))*.8,goal:i<m.homeScore}));
  const aShots=Array.from({length:m.stats.shots[1]},(_,i)=>({x:W*.38-Math.sin(i*3.7+seed)*.28*W,y:H*.3+Math.cos(i*2.3+seed+1)*.4*H,xg:.05+Math.abs(Math.sin(i*1.7+seed+1))*.8,goal:i<m.awayScore}));
  const ds=(shots,color)=>shots.forEach(s=>{const r=5+s.xg*18;ctx.beginPath();ctx.arc(s.x,s.y,r,0,Math.PI*2);ctx.fillStyle=s.goal?'rgba(0,255,135,.8)':`rgba(${color},.6)`;ctx.strokeStyle=s.goal?'#00ff87':`rgba(${color},.9)`;ctx.lineWidth=s.goal?2:1;ctx.fill();ctx.stroke();});
  ds(hShots,'56,189,248'); ds(aShots,'244,63,94');
  ctx.fillStyle='rgba(255,255,255,.4)';ctx.font='10px Barlow Condensed';ctx.textAlign='left';ctx.fillText('âš½ Goal  â—‹ Size = xG',W*.02,H-10);
}

function drawPassNetwork(canvasId, m) {
  const canvas=document.getElementById(canvasId); if(!canvas)return;
  const W=canvas.width=canvas.offsetWidth||700, H=canvas.height=320;
  const ctx=canvas.getContext('2d');
  for(let i=0;i<12;i++){ctx.fillStyle=i%2===0?'#1e9148':'#197a3d';ctx.fillRect(i*(W/12),0,W/12,H);}
  ctx.strokeStyle='rgba(255,255,255,.35)';ctx.lineWidth=1;
  ctx.strokeRect(14,14,W-28,H-28);ctx.beginPath();ctx.moveTo(W/2,14);ctx.lineTo(W/2,H-14);ctx.stroke();
  const nodes=[{x:.08,y:.5,r:14,c:'60,160,248',n:'GK'},{x:.22,y:.25,r:11,c:'60,160,248',n:'RB'},{x:.22,y:.42,r:12,c:'60,160,248',n:'CB'},{x:.22,y:.58,r:12,c:'60,160,248',n:'CB'},{x:.22,y:.75,r:11,c:'60,160,248',n:'LB'},{x:.36,y:.38,r:15,c:'60,160,248',n:'DM'},{x:.48,y:.35,r:16,c:'0,230,135',n:'CM'},{x:.36,y:.62,r:13,c:'60,160,248',n:'CM'},{x:.6,y:.22,r:12,c:'60,160,248',n:'RW'},{x:.68,y:.5,r:17,c:'251,200,0',n:'ST'},{x:.6,y:.78,r:12,c:'60,160,248',n:'LW'}];
  const links=[[0,1,4],[0,2,6],[0,3,5],[1,5,3],[2,5,5],[3,5,4],[4,7,3],[5,6,7],[6,7,5],[6,8,4],[6,9,6],[7,9,4],[8,9,5],[10,9,4]];
  links.forEach(([a,b,w])=>{const na=nodes[a],nb=nodes[b];ctx.beginPath();ctx.moveTo(na.x*W,na.y*H);ctx.lineTo(nb.x*W,nb.y*H);ctx.strokeStyle=`rgba(56,189,248,${Math.min(w/7,.7)})`;ctx.lineWidth=w*.6;ctx.stroke();});
  nodes.forEach(n=>{ctx.beginPath();ctx.arc(n.x*W,n.y*H,n.r,0,Math.PI*2);ctx.fillStyle=`rgba(${n.c},.85)`;ctx.fill();ctx.strokeStyle='rgba(255,255,255,.3)';ctx.lineWidth=1.5;ctx.stroke();ctx.fillStyle='white';ctx.font='bold 8px Barlow Condensed';ctx.textAlign='center';ctx.fillText(n.n,n.x*W,n.y*H+3);});
}

function drawMomentum(canvasId, m) {
  const canvas=document.getElementById(canvasId); if(!canvas)return;
  const W=canvas.width=canvas.offsetWidth||700, H=canvas.height=120;
  const ctx=canvas.getContext('2d');
  ctx.fillStyle='#141e2b';ctx.fillRect(0,0,W,H);
  ctx.strokeStyle='rgba(255,255,255,.08)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(0,H/2);ctx.lineTo(W,H/2);ctx.stroke();
  const seed=m.id.charCodeAt(m.id.length-1);
  const pts=[];for(let i=0;i<=90;i++){const v=.5+.35*Math.sin(i*.08+seed)+.15*Math.sin(i*.2+seed+1)+.1*Math.cos(i*.35+seed);pts.push({x:i/90*W,y:H/2-(v-.5)*(H*.8)});}
  ctx.beginPath();pts.forEach((p,i)=>i===0?ctx.moveTo(p.x,p.y):ctx.lineTo(p.x,p.y));
  ctx.strokeStyle='rgba(0,255,135,.7)';ctx.lineWidth=2;ctx.stroke();
  ctx.lineTo(W,H/2);ctx.lineTo(0,H/2);ctx.closePath();ctx.fillStyle='rgba(0,255,135,.08)';ctx.fill();
  m.events.filter(e=>e.type==='goal').forEach(e=>{
    const x=e.min/90*W;ctx.strokeStyle=e.team==='home'?'rgba(56,189,248,.8)':'rgba(244,63,94,.8)';ctx.lineWidth=1.5;ctx.setLineDash([4,3]);ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke();ctx.setLineDash([]);
    ctx.fillStyle=e.team==='home'?'#38bdf8':'#f43f5e';ctx.font='10px Barlow Condensed';ctx.textAlign='center';ctx.fillText('âš½',x,12);
  });
  ctx.fillStyle='rgba(255,255,255,.3)';ctx.font='9px Barlow Condensed';ctx.textAlign='left';
  ["0'","45'","90'"].forEach((l,i)=>ctx.fillText(l,i*(W/2)+3,H-4));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PLAYERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPlayersList() {
  const search=(document.getElementById('playerSearch')?.value||'').toLowerCase();
  const pos=document.getElementById('posFilter')?.value||'all';
  const team=document.getElementById('teamFilter')?.value||'all';
  let list=PLAYERS.filter(p=>{
    if(search&&!p.name.toLowerCase().includes(search)&&!p.team.toLowerCase().includes(search))return false;
    if(pos!=='all'&&p.posGroup!==pos)return false;
    if(team!=='all'&&p.team!==team)return false;
    return true;
  });
  const ct=document.getElementById('playerCount');
  if(ct)ct.textContent=`${list.length} player${list.length!==1?'s':''} found`;
  const el=document.getElementById('playersList');
  if(!el)return;
  el.innerHTML=list.map(p=>`
    <div class="player-card" onclick="navigate('player','${p.id}')">
      <div class="pc-avi">${p.avi}</div>
      <div class="pc-info"><div class="pc-name">${p.name}</div><div class="pc-detail"><span class="tag tag-${posTagClass(p.posGroup)}">${p.pos}</span><span>${p.team}</span></div></div>
      <div style="text-align:right;flex-shrink:0;"><div class="pc-rating" style="color:${ratingColor(p.rating)}">${p.rating}</div><div style="font-size:.6rem;color:var(--text3);">${p.goals}G ${p.ast}A</div></div>
    </div>`).join('');
}
function filterPlayers(){renderPlayersList();}

function renderPlayerDetail(id) {
  const p=PLAYERS.find(x=>x.id===id); if(!p)return;
  document.getElementById('playerDetailContent').innerHTML=`
    <div style="display:flex;align-items:flex-start;gap:14px;margin-bottom:14px;background:var(--s2);border:1px solid var(--border);border-radius:var(--radius);padding:16px;flex-wrap:wrap;">
      <div style="font-size:3rem;">${p.avi}</div>
      <div style="flex:1;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:2px;">${p.name}</div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:4px;flex-wrap:wrap;"><span class="tag tag-${posTagClass(p.posGroup)}">${p.pos}</span><span style="font-size:.75rem;color:var(--text2);">${p.team}</span></div>
        <div style="display:grid;grid-template-columns:repeat(4,auto);gap:14px;margin-top:12px;width:fit-content;">
          ${[['Rating',p.rating,ratingColor(p.rating)],['Goals',p.goals,'var(--accent)'],['Assists',p.ast,'var(--blue)'],['Pass%',p.passAcc+'%','var(--orange)']].map(([l,v,c])=>`<div style="text-align:center;"><div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;color:${c};line-height:1">${v}</div><div style="font-size:.62rem;color:var(--text3);text-transform:uppercase;letter-spacing:.5px">${l}</div></div>`).join('')}
        </div>
      </div>
    </div>
    <div class="tab-bar" id="playerTabs_${id}">
      <button class="tab-btn active" onclick="switchPlayerTab(this,'abilities','${id}')">Abilities</button>
      <button class="tab-btn" onclick="switchPlayerTab(this,'heatmap','${id}')">Heatmap</button>
      <button class="tab-btn" onclick="switchPlayerTab(this,'compare','${id}')">Compare</button>
    </div>
    <div id="playerTabContent_${id}"></div>`;
  switchPlayerTab(document.querySelector(`#playerTabs_${id} .tab-btn`),'abilities',id);
}

function switchPlayerTab(el,tab,id) {
  const bar=document.getElementById('playerTabs_'+id);
  if(bar)bar.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  if(el)el.classList.add('active');
  const p=PLAYERS.find(x=>x.id===id);
  const content=document.getElementById('playerTabContent_'+id);
  if(!content||!p)return;
  if(tab==='abilities'){
    const attrs=Object.entries(p.attrs);
    content.innerHTML=`<div class="grid2">
      <div class="card"><div class="card-title">Ability Radar</div><div class="radar-wrap"><canvas id="rc_${id}" width="240" height="210"></canvas><div style="font-size:.68rem;color:var(--text2);text-align:center">${p.name} â€” ${p.pos}</div></div></div>
      <div class="card"><div class="card-title">Attributes</div>${attrs.map(([k,v])=>`<div class="sbar"><div class="sbar-row"><span class="lbl">${k}</span><span class="val">${v}</span></div><div class="sbar-track"><div class="sbar-fill ${v>=90?'fill-g':v>=80?'fill-b':'fill-o'}" style="width:${v}%"></div></div></div>`).join('')}</div>
    </div>
    <div class="card" style="margin-top:12px"><div class="card-title">Season Stats</div><div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px;">${p.mini.map(m=>`<div class="stat-box"><div class="num" style="font-size:1.4rem">${m.split(' ')[0]}</div><div class="lbl">${m.split(' ').slice(1).join(' ')}</div></div>`).join('')}<div class="stat-box"><div class="num" style="font-size:1.4rem">${p.passAcc}%</div><div class="lbl">Pass Acc.</div></div></div></div>`;
    setTimeout(()=>drawPlayerRadar('rc_'+id,p,null),80);
  } else if(tab==='heatmap'){
    content.innerHTML=`<div class="card"><div class="card-title">Player Heatmap â€” ${p.name}</div><div class="heat-canvas-box"><canvas id="phc_${id}" class="heat" height="300"></canvas></div></div>`;
    setTimeout(()=>drawPlayerHeatmap('phc_'+id,p),50);
  } else if(tab==='compare'){
    const others=PLAYERS.filter(x=>x.id!==id).slice(0,10);
    content.innerHTML=`<div class="card"><div class="card-title">Compare Players</div><div class="field"><label>Compare With</label><select id="cmpSel_${id}" onchange="doPlayerCompare('${id}',this.value)">${others.map(x=>`<option value="${x.id}">${x.name} (${x.team})</option>`).join('')}</select></div><canvas id="crc_${id}" width="260" height="220"></canvas><div id="crcLgd_${id}" style="display:flex;gap:12px;justify-content:center;margin-top:8px;flex-wrap:wrap;"></div></div>`;
    setTimeout(()=>doPlayerCompare(id,others[0].id),80);
  }
}

function drawPlayerHeatmap(canvasId,p){
  const canvas=document.getElementById(canvasId); if(!canvas)return;
  const W=canvas.width=canvas.offsetWidth||600, H=canvas.height||300;
  const ctx=canvas.getContext('2d');
  for(let i=0;i<12;i++){ctx.fillStyle=i%2===0?'#1e9148':'#197a3d';ctx.fillRect(i*(W/12),0,W/12,H);}
  ctx.strokeStyle='rgba(255,255,255,.4)';ctx.lineWidth=1.5;ctx.strokeRect(14,14,W-28,H-28);ctx.beginPath();ctx.moveTo(W/2,14);ctx.lineTo(W/2,H-14);ctx.stroke();ctx.strokeRect(14,H/2-55,95,110);ctx.strokeRect(W-109,H/2-55,95,110);
  const blobs={GK:[{x:.08,y:.5,r:.08}],DEF:[{x:.25,y:.5,r:.14},{x:.2,y:.35,r:.1},{x:.2,y:.65,r:.1}],MID:[{x:.42,y:.5,r:.16},{x:.55,y:.45,r:.12},{x:.35,y:.5,r:.1}],ATK:[{x:.7,y:.5,r:.18},{x:.62,y:.35,r:.12},{x:.62,y:.65,r:.12}]};
  (blobs[p.posGroup]||blobs.MID).forEach(({x,y,r})=>{
    const grd=ctx.createRadialGradient(x*W,y*H,0,x*W,y*H,r*W);
    grd.addColorStop(0,'rgba(0,255,135,.75)');grd.addColorStop(.5,'rgba(0,255,135,.4)');grd.addColorStop(1,'rgba(0,255,135,0)');
    ctx.beginPath();ctx.arc(x*W,y*H,r*W,0,Math.PI*2);ctx.fillStyle=grd;ctx.fill();
  });
}

function drawPlayerRadar(canvasId,p,cmp){
  const canvas=document.getElementById(canvasId); if(!canvas)return;
  const ctx=canvas.getContext('2d'),W=canvas.width,H=canvas.height;
  ctx.clearRect(0,0,W,H);
  const labels=Object.keys(p.attrs),vA=Object.values(p.attrs),vB=cmp?Object.values(cmp.attrs):null;
  const n=labels.length,cx=W/2,cy=H/2,r=Math.min(cx,cy)*.73;
  for(let i=1;i<=5;i++){ctx.beginPath();for(let j=0;j<n;j++){const a=(j/n)*Math.PI*2-Math.PI/2,rr=(r/5)*i;ctx.lineTo(cx+Math.cos(a)*rr,cy+Math.sin(a)*rr);}ctx.closePath();ctx.strokeStyle='rgba(30,46,62,.9)';ctx.lineWidth=1;ctx.stroke();ctx.fillStyle=i%2===0?'rgba(14,20,30,.5)':'rgba(14,20,30,.3)';ctx.fill();}
  ctx.strokeStyle='rgba(60,90,120,.5)';ctx.lineWidth=.8;for(let j=0;j<n;j++){const a=(j/n)*Math.PI*2-Math.PI/2;ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(cx+Math.cos(a)*r,cy+Math.sin(a)*r);ctx.stroke();}
  const dp=(vals,fill,stroke)=>{ctx.beginPath();vals.forEach((v,j)=>{const a=(j/n)*Math.PI*2-Math.PI/2,rr=(v/100)*r;ctx.lineTo(cx+Math.cos(a)*rr,cy+Math.sin(a)*rr);});ctx.closePath();ctx.fillStyle=fill;ctx.fill();ctx.strokeStyle=stroke;ctx.lineWidth=2;ctx.stroke();};
  dp(vA,'rgba(0,255,135,.18)','#00ff87');
  if(vB)dp(vB,'rgba(244,63,94,.15)','#f43f5e');
  ctx.fillStyle='rgba(200,220,240,.75)';ctx.font='bold 9px Barlow Condensed';ctx.textAlign='center';
  labels.forEach((l,j)=>{const a=(j/n)*Math.PI*2-Math.PI/2;ctx.fillText(l,cx+Math.cos(a)*(r+16),cy+Math.sin(a)*(r+16)+3);});
}

function doPlayerCompare(id,cmpId){
  const p=PLAYERS.find(x=>x.id===id),c=PLAYERS.find(x=>x.id===cmpId); if(!p||!c)return;
  drawPlayerRadar('crc_'+id,p,c);
  const lg=document.getElementById('crcLgd_'+id);
  if(lg)lg.innerHTML=`<div style="display:flex;align-items:center;gap:5px;font-size:.7rem;"><div style="width:10px;height:10px;border-radius:50%;background:#00ff87"></div>${p.name}</div><div style="display:flex;align-items:center;gap:5px;font-size:.7rem;"><div style="width:10px;height:10px;border-radius:50%;background:#f43f5e"></div>${c.name}</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  REPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderReports(){
  const m=MATCHES[0];
  document.getElementById('reportsContent').innerHTML=`
    <div class="report-header">
      <div class="report-title">MATCH ANALYSIS REPORT</div>
      <div class="report-sub">${m.home} ${m.homeScore}â€“${m.awayScore} ${m.away} Â· ${m.comp} Â· ${m.date}</div>
      <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;">
        <button class="btn btn-primary" onclick="window.print()">â¬‡ Export PDF</button>
        <button class="btn btn-secondary" onclick="copyReport()">ğŸ“‹ Copy</button>
        <button class="btn" style="background:rgba(251,146,60,.1);border:1px solid rgba(251,146,60,.3);color:var(--orange);" onclick="autoReport()">ğŸ¤– Auto-Generate</button>
      </div>
    </div>
    <div class="grid2">
      <div>
        <div class="card" style="margin-bottom:12px"><div class="report-h">Executive Summary</div><p class="report-p" id="reportSummary">${m.home} delivered a dominant performance in this ${m.comp} fixture, winning <strong>${m.homeScore}â€“${m.awayScore}</strong>. The home side controlled possession at <strong>${m.stats.possession[0]}%</strong> and generated superior xG of <strong>${m.stats.xg[0]}</strong> vs <strong>${m.stats.xg[1]}</strong>. <strong>${m.homeManager}'s</strong> high press was particularly effective throughout.</p></div>
        <div class="card" style="margin-bottom:12px"><div class="report-h">Head-to-Head</div>${[['Possession',m.stats.possession[0],m.stats.possession[1],'%'],['Shots',m.stats.shots[0],m.stats.shots[1],''],['xG',m.stats.xg[0],m.stats.xg[1],''],['Pass Acc.',m.stats.passAcc[0],m.stats.passAcc[1],'%'],['Corners',m.stats.corners[0],m.stats.corners[1],''],['Fouls',m.stats.fouls[0],m.stats.fouls[1],'']].map(([l,h,a,u])=>{const pct=Math.round(+h/(+h+ +a)*100);return`<div class="cmp-row" style="margin-bottom:10px"><div class="cmp-hd"><span class="cmp-l">${h}${u}</span><span class="cmp-lbl">${l}</span><span class="cmp-r">${a}${u}</span></div><div class="cmp-track"><div class="cmp-left" style="width:${pct}%"></div><div class="cmp-right"></div></div></div>`;}).join('')}</div>
        <div class="card"><div class="report-h">Predictions & Recommendations</div><p class="report-p">Continue exploiting left half-space. Manage press intensity to preserve energy. Consider midfield cover in final 15 minutes.</p></div>
      </div>
      <div>
        <div class="card" style="margin-bottom:12px"><div class="report-h">Performance Grades</div><div class="grade-row">${[['Haaland',9.1,'#00ff87'],['De Bruyne',8.7,'#00ff87'],['Rodri',8.9,'#00ff87'],['Bellingham',8.4,'#fbbf24'],['MbappÃ©',7.2,'#fbbf24']].map(([n,r,c])=>`<div class="grade-item"><div class="grade-circle" style="border-color:${c};color:${c};">${r}</div><div class="grade-name">${n}</div></div>`).join('')}</div></div>
        <div class="card" style="margin-bottom:12px"><div class="report-h">Win Probability</div><div class="prob-nums"><span style="color:var(--blue)">${m.winProb[0]}%</span><span style="font-size:.9rem;color:var(--text3)">${m.winProb[1]}%</span><span style="color:var(--red)">${m.winProb[2]}%</span></div><div class="prob-bar"><div class="prob-h" style="width:${m.winProb[0]}%"></div><div class="prob-d" style="width:${m.winProb[1]}%"></div><div class="prob-a"></div></div><div style="display:flex;justify-content:space-between;font-size:.62rem;color:var(--text3)"><span>${m.home}</span><span>Draw</span><span>${m.away}</span></div></div>
        <div class="card"><div class="report-h">Match Rating</div><div style="text-align:center;padding:10px 0;"><div style="font-family:'Bebas Neue',sans-serif;font-size:3.5rem;color:var(--accent);line-height:1;text-shadow:var(--accent-glow)">7.9</div><div style="font-size:.68rem;color:var(--text2);margin-top:4px">Overall Match Quality</div></div>${[['Tactical Quality',82,'g'],['Intensity',78,'b'],['Chance Quality',74,'o'],['Entertainment',85,'g']].map(([l,w,c])=>`<div class="sbar"><div class="sbar-row"><span class="lbl">${l}</span><span class="val">${(w/10).toFixed(1)}</span></div><div class="sbar-track"><div class="sbar-fill fill-${c}" style="width:${w}%"></div></div></div>`).join('')}</div>
      </div>
    </div>`;
}
function autoReport(){const s=document.getElementById('reportSummary');if(s)s.innerHTML='Auto-analysis: <strong>Manchester City</strong> dominated through tactical superiority. xG of <strong>2.41 vs 1.33</strong>, <strong>63% possession</strong>, <strong>7 shots on target</strong>. Guardiola\'s high press generated 11 mid/final third turnovers, 3 converted to direct attempts.';}
function copyReport(){navigator.clipboard.writeText(document.getElementById('reportsContent')?.innerText||'').then(()=>showToast('Report copied!','success'));}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS â€” API PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSettingsAPIPanel(){
  if(document.getElementById('apiSettingsSection'))return;
  const settingsPage=document.getElementById('page-settings');
  if(!settingsPage)return;
  const section=document.createElement('div');
  section.id='apiSettingsSection';
  section.innerHTML=`
    <div class="card-title" style="margin-bottom:8px;margin-top:16px"><span style="color:var(--accent)">âš¡ Live Data API</span></div>
    <div class="notice" style="margin-bottom:10px"><span class="notice-icon">ğŸ”Œ</span><span>Connect your backend to enable live match data, real-time stats, and auto-refreshing visuals. Compatible with the <strong>TacticaIQ Live Data Engine</strong>.</span></div>
    <div class="setting-row">
      <div class="sr-left"><div class="sr-title">API Base URL</div><div class="sr-sub">e.g. https://your-backend.com/api</div></div>
      <div class="sr-right" style="flex:1;max-width:280px;"><input type="text" id="apiBaseInput" placeholder="https://your-backend-url.com/api" value="${API_BASE}" style="width:100%;background:var(--s4);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:.75rem;padding:6px 9px;outline:none;"></div>
    </div>
    <div class="setting-row">
      <div class="sr-left"><div class="sr-title">Poll Interval</div><div class="sr-sub">How often to refresh live data</div></div>
      <div class="sr-right"><select id="pollInterval" style="background:var(--s4);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:.75rem;padding:5px 8px;outline:none;"><option value="10000">10 seconds</option><option value="20000" selected>20 seconds</option><option value="30000">30 seconds</option><option value="60000">60 seconds</option></select></div>
    </div>
    <div class="setting-row">
      <div class="sr-left"><div class="sr-title">Connection Status</div><div class="sr-sub">${liveConnected?'ğŸŸ¢ Connected':'ğŸ”´ Not connected'}</div></div>
      <div class="sr-right"><div class="tgl ${liveConnected?'on':''}" onclick="this.classList.toggle('on');this.classList.contains('on')?startLivePolling():stopLivePolling()"><div class="tgl-k"></div></div></div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
      <button class="btn btn-primary" onclick="saveAPISettings()">ğŸ’¾ Save & Connect</button>
      <button class="btn btn-secondary" id="testAPIBtn" onclick="testAPIConnection()">ğŸ”Œ Test Connection</button>
      <button class="btn btn-secondary" onclick="stopLivePolling();showToast('Polling paused','info')">â¸ Pause</button>
    </div>
    <div style="margin-top:14px;background:var(--s3);border:1px solid var(--border);border-radius:8px;padding:12px;">
      <div class="card-title" style="margin-bottom:8px;font-size:.72rem;">Expected Endpoints</div>
      <div style="font-size:.68rem;color:var(--text2);line-height:2.2;font-family:'JetBrains Mono',monospace;">
        <div><span style="color:var(--accent)">GET</span>  /live <span style="color:var(--text3)">â€” Active live matches array</span></div>
        <div><span style="color:var(--accent)">GET</span>  /match/:id/stats <span style="color:var(--text3)">â€” Match statistics</span></div>
        <div><span style="color:var(--accent)">GET</span>  /match/:id/events <span style="color:var(--text3)">â€” Match events array</span></div>
        <div><span style="color:var(--accent)">GET</span>  /players/:id <span style="color:var(--text3)">â€” Player data</span></div>
      </div>
    </div>`;
  const firstBtn=settingsPage.querySelector('div[style*="display:flex;gap:8px"]');
  if(firstBtn)settingsPage.insertBefore(section,firstBtn);
  else settingsPage.appendChild(section);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SEARCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _searchCache=[];
function openSearch(){
  document.getElementById('searchOverlay').classList.add('show');
  setTimeout(()=>document.getElementById('searchOverlayInput')?.focus(),50);
}
function closeSearch(){
  document.getElementById('searchOverlay').classList.remove('show');
  const inp=document.getElementById('searchOverlayInput');
  if(inp)inp.value='';
  const res=document.getElementById('searchResults');
  if(res)res.innerHTML='';
}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeSearch();});
function doSearch(q){
  const res=document.getElementById('searchResults'); if(!res)return;
  if(!q.trim()){res.innerHTML='';return;}
  const ql=q.toLowerCase();
  _searchCache=[];
  MATCHES.forEach(m=>{if(m.home.toLowerCase().includes(ql)||m.away.toLowerCase().includes(ql)||m.comp.toLowerCase().includes(ql))_searchCache.push({icon:'âš½',title:`${m.home} ${m.homeScore}â€“${m.awayScore} ${m.away}`,sub:m.comp+' Â· '+m.date,fn:()=>{closeSearch();navigate('match',m.id);}});});
  PLAYERS.forEach(p=>{if(p.name.toLowerCase().includes(ql)||p.team.toLowerCase().includes(ql))_searchCache.push({icon:p.avi,title:p.name,sub:`${p.pos} Â· ${p.team}`,fn:()=>{closeSearch();navigate('player',p.id);}});});
  res.innerHTML=_searchCache.slice(0,8).map((r,i)=>`<div class="sr-item" onclick="_searchCache[${i}].fn()"><span class="sri-icon">${r.icon}</span><div><div class="sri-title">${r.title}</div><div class="sri-sub">${r.sub}</div></div></div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ratingColor(r){return r>=8.5?'var(--accent)':r>=7.5?'var(--yellow)':'var(--red)';}
function posTagClass(pg){return{GK:'orange',DEF:'blue',MID:'green',ATK:'red'}[pg]||'green';}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  renderHome();
  renderMatches();
  // shimmer keyframe
  const s=document.createElement('style');
  s.textContent='@keyframes shimmer{0%{background-position:-700px 0}100%{background-position:700px 0}}';
  document.head.appendChild(s);
  // Show API status after short delay
  setTimeout(()=>{
    if(API_BASE) startLivePolling();
    else setAPIStatus(false,'Configure your API URL in Settings â†’');
  },400);
});
</script>
</body>
</html>
